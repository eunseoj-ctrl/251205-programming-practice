<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SDGs Ã— ì´ˆìŒíŒŒ ì„¼ì„œ ë¬¸ì œí•´ê²° ì„¤ê³„ í”Œë«í¼</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Pretendard', 'Noto Sans KR', system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #312e81 100%);
      color: #1e293b;
      min-height: 100vh;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 50%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 40% 20%, rgba(79, 70, 229, 0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    /* í™”ë©´ ì „í™˜ ì»¨í…Œì´ë„ˆ */
    .view-section {
      display: none;
      width: 100%;
      max-width: 1000px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 24px;
      box-shadow: 0 20px 40px rgba(79, 70, 229, 0.2), 0 8px 16px rgba(139, 92, 246, 0.15);
      border: 1px solid rgba(139, 92, 246, 0.2);
      overflow: hidden;
      animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      position: relative;
      z-index: 1;
    }
    .view-section.active { 
      display: block; 
    }
    
    /* ì¸íŠ¸ë¡œ í™”ë©´ íŠ¹ë³„ ìŠ¤íƒ€ì¼ */
    #view-intro {
      background: transparent;
      box-shadow: none;
      border: none;
      max-width: 100%;
      width: 100%;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      padding: 0;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes batHover {
      0%, 100% { transform: translateY(-50%) translateY(0px); }
      50% { transform: translateY(-50%) translateY(-15px); }
    }

    @keyframes bubbleFloat {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-5px); }
    }

    /* --- 1. ì¸íŠ¸ë¡œ & ë¡œê·¸ì¸ ìŠ¤íƒ€ì¼ --- */
    #intro-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #312e81 100%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 100;
    }
    
    /* ë°•ì¥ ì• ë‹ˆë©”ì´ì…˜ ì»¨í…Œì´ë„ˆ */
    #bat-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }
    
    .flying-bat {
      position: absolute;
      font-size: 2rem;
      opacity: 0.6;
      animation: flyAround linear infinite;
      will-change: transform;
    }
    
    @keyframes flyAround {
      0% { 
        transform: translate(-10vw, 0) rotate(0deg) scale(1); 
        opacity: 0;
      }
      10% { opacity: 0.8; }
      25% { 
        transform: translate(20vw, -10vh) rotate(10deg) scale(1.1); 
      }
      50% { 
        transform: translate(50vw, 5vh) rotate(0deg) scale(1); 
      }
      75% { 
        transform: translate(80vw, -5vh) rotate(-10deg) scale(0.9); 
      }
      90% { opacity: 0.8; }
      100% { 
        transform: translate(110vw, 0) rotate(0deg) scale(1); 
        opacity: 0;
      }
    }
    
    /* ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜ ì»¨í…ì¸  */
    .intro-content {
      position: relative;
      z-index: 10;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 60px;
      border-radius: 32px;
      text-align: center;
      box-shadow: 0 25px 50px rgba(0,0,0,0.5);
      max-width: 800px;
      width: 90%;
      animation: popIn 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    @keyframes popIn {
      from { transform: scale(0.9) translateY(20px); opacity: 0; }
      to { transform: scale(1) translateY(0); opacity: 1; }
    }
    
    .main-icon {
      font-size: 5rem;
      margin-bottom: 10px;
      display: inline-block;
      animation: float 3s infinite ease-in-out;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    .intro-title {
      font-size: 3.5rem;
      font-weight: 900;
      color: #ffffff;
      margin-bottom: 10px;
      text-shadow: 0 4px 15px rgba(0,0,0,0.3);
      letter-spacing: -1px;
    }
    
    .intro-subtitle {
      font-size: 1.2rem;
      color: #bfdbfe;
      margin-bottom: 50px;
      font-weight: 300;
    }
    
    .role-cards {
      display: flex;
      gap: 25px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .role-card {
      flex: 1;
      min-width: 200px;
      background: rgba(255, 255, 255, 0.85);
      padding: 30px 20px;
      border-radius: 24px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      text-align: center;
      border: 2px solid transparent;
      position: relative;
      overflow: hidden;
    }
    
    .role-card:hover {
      transform: translateY(-12px) scale(1.03);
      background: #ffffff;
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
      border-color: #fbbf24;
    }
    
    .role-card:active {
      transform: scale(0.98);
    }
    
    .role-icon {
      font-size: 48px;
      margin-bottom: 15px;
      display: block;
    }
    
    .role-name {
      font-size: 1.5rem;
      font-weight: 800;
      color: #1e293b;
      margin-bottom: 5px;
    }
    
    .role-desc {
      font-size: 0.95rem;
      color: #64748b;
      font-weight: 500;
    }
    
    /* ê¸°ì¡´ intro-wrap (ë¡œê·¸ì¸ í™”ë©´ìš©) */
    .intro-wrap {
      padding: 60px 40px;
      text-align: center;
      max-width: 600px;
      margin: 0 auto;
    }
    .intro-icon { font-size: 60px; margin-bottom: 20px; display: inline-block; }
    .intro-title-alt { 
      font-size: 28px; 
      font-weight: 800; 
      background: linear-gradient(135deg, #8b5cf6, #6366f1);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 12px; 
    }
    .intro-desc { color: #cbd5e1; margin-bottom: 40px; font-size: 16px; line-height: 1.6; }
    
    .role-emoji { font-size: 48px; margin-bottom: 15px; display: block; }
    .role-name-alt { font-size: 18px; font-weight: 700; color: #8b5cf6; }
    .role-sub { font-size: 13px; color: #94a3b8; margin-top: 6px; }

    /* ë¡œê·¸ì¸ í¼ */
    .login-box { text-align: left; background: rgba(237, 233, 254, 0.5); backdrop-filter: blur(10px); padding: 30px; border-radius: 16px; margin-top: 20px; border: 1px solid rgba(139, 92, 246, 0.2); }
    .input-label { font-size: 14px; font-weight: 700; color: #7c3aed; margin-bottom: 8px; display: block; }
    .input-field {
      width: 100%; padding: 14px; border: 2px solid rgba(139, 92, 246, 0.3); border-radius: 12px; font-size: 16px; margin-bottom: 20px; transition: all 0.2s;
      background: rgba(255, 255, 255, 0.9);
    }
    .input-field:focus { outline: none; border-color: #8b5cf6; background: #fff; box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1); }
    
    .btn-primary {
      width: 100%; padding: 16px; background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; border: none; border-radius: 12px;
      font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.2s;
      box-shadow: 0 4px 6px rgba(139, 92, 246, 0.3);
    }
    .btn-primary:hover { 
      background: linear-gradient(135deg, #7c3aed, #4f46e5); 
      transform: translateY(-1px);
      box-shadow: 0 6px 12px rgba(139, 92, 246, 0.4);
    }
    .btn-text { background: none; border: none; color: #8b5cf6; margin-top: 15px; cursor: pointer; text-decoration: underline; font-size: 14px; }

    /* --- 2. êµì‚¬ ëŒ€ì‹œë³´ë“œ & ì„¤ì • --- */
    .dash-header {
      padding: 20px 30px; background: #fff; border-bottom: 1px solid #e2e8f0;
      display: flex; justify-content: space-between; align-items: center;
    }
    .dash-title { font-size: 20px; font-weight: 800; background: linear-gradient(135deg, #8b5cf6, #6366f1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; display: flex; align-items: center; gap: 8px; }
    .dash-controls { display: flex; gap: 10px; }
    .btn-sm { padding: 8px 16px; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; border: 1px solid #e2e8f0; background: #fff; color: #475569; transition: all 0.2s; }
    .btn-sm:hover { background: #f1f5f9; }
    .btn-sm.danger { color: #ef4444; border-color: #fee2e2; }
    .btn-sm.danger:hover { background: #fef2f2; }

    .dash-content { padding: 30px; background: rgba(237, 233, 254, 0.3); min-height: 500px; max-height: 80vh; overflow-y: auto; }
    
    /* í•™ê¸‰/í•™ìƒë³„ ê´€ë¦¬ ìŠ¤íƒ€ì¼ */
    .teacher-tabs {
      display: flex; gap: 8px; padding: 0 30px; background: #fff; border-bottom: 1px solid #e2e8f0;
    }
    .teacher-tab {
      padding: 12px 20px; font-size: 14px; font-weight: 600; cursor: pointer;
      border: none; background: transparent; color: #64748b; border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }
    .teacher-tab.active {
      color: #8b5cf6; border-bottom-color: #8b5cf6; background: rgba(139, 92, 246, 0.05);
    }
    .teacher-tab:hover {
      color: #8b5cf6; background: rgba(139, 92, 246, 0.05);
    }
    
    .management-layout {
      display: flex; height: calc(80vh - 100px); background: #fff;
    }
    
    .class-list-panel {
      width: 250px; border-right: 1px solid #e2e8f0; overflow-y: auto;
      background: #f8fafc;
    }
    .class-list-header {
      padding: 15px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;
      background: #fff;
    }
    .class-list-title {
      font-size: 14px; font-weight: 700; color: #1e293b;
    }
    .btn-add-class {
      width: 28px; height: 28px; border-radius: 6px; border: 1px solid #cbd5e1;
      background: #fff; color: #64748b; font-size: 18px; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.2s;
    }
    .btn-add-class:hover {
      background: #3b82f6; color: white; border-color: #3b82f6;
    }
    
    .class-item {
      padding: 12px 15px; cursor: pointer; border-bottom: 1px solid #f1f5f9;
      transition: background 0.2s; font-size: 13px; font-weight: 600; color: #475569;
    }
    .class-item:hover {
      background: #ede9fe;
    }
    .class-item.active {
      background: #e9d5ff; color: #6d28d9; border-left: 3px solid #8b5cf6;
    }
    
    .student-list-panel {
      width: 280px; border-right: 1px solid #e2e8f0; overflow-y: auto;
      background: #f8fafc;
    }
    .student-list-header {
      padding: 15px; border-bottom: 1px solid #e2e8f0; background: #fff;
      font-size: 14px; font-weight: 700; color: #1e293b;
    }
    .student-item {
      padding: 12px 15px; cursor: pointer; border-bottom: 1px solid #f1f5f9;
      transition: background 0.2s; font-size: 13px; color: #475569;
      display: flex; justify-content: space-between; align-items: center;
    }
    .student-item:hover {
      background: #e0e7ff;
    }
    .student-item.active {
      background: #dbeafe; color: #1e40af; border-left: 3px solid #3b82f6;
    }
    .student-badge {
      font-size: 11px; padding: 2px 8px; border-radius: 10px;
      background: #fee2e2; color: #991b1b; font-weight: 600;
    }
    .student-actions {
      display: flex; gap: 5px; align-items: center;
    }
    .btn-delete-student {
      padding: 4px 8px; font-size: 11px; background: #fee2e2; color: #991b1b;
      border: none; border-radius: 6px; cursor: pointer; font-weight: 600;
      transition: all 0.2s;
    }
    .btn-delete-student:hover {
      background: #fecaca; transform: scale(1.05);
    }
    
    .student-content-panel {
      flex: 1; overflow-y: auto; background: #fff; padding: 30px;
    }
    .student-worksheet {
      background: white; border-radius: 16px; padding: 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05); max-width: 800px; margin: 0 auto;
    }
    .worksheet-header {
      border-bottom: 2px solid #e2e8f0; padding-bottom: 20px; margin-bottom: 30px;
      display: flex; justify-content: space-between; align-items: center;
    }
    .worksheet-title {
      font-size: 24px; font-weight: 800; color: #1e293b;
    }
    .worksheet-status {
      padding: 6px 16px; border-radius: 20px; font-size: 13px; font-weight: 600;
    }
    .worksheet-status.pending { background: #fffbeb; color: #b45309; }
    .worksheet-status.approved { background: #dcfce7; color: #15803d; }
    .worksheet-status.rejected { background: #fef2f2; color: #b91c1c; }
    
    .worksheet-section {
      margin-bottom: 30px;
    }
    .worksheet-label {
      font-size: 12px; font-weight: 700; color: #64748b; text-transform: uppercase;
      letter-spacing: 0.5px; margin-bottom: 8px;
    }
    .worksheet-value {
      font-size: 15px; color: #1e293b; line-height: 1.6;
      padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;
    }
    
    .worksheet-feedback {
      margin-top: 30px; padding-top: 30px; border-top: 2px solid #e2e8f0;
    }
    .worksheet-feedback-input {
      width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px;
      font-size: 14px; margin-bottom: 15px; min-height: 80px; resize: vertical;
    }
    .worksheet-actions {
      display: flex; gap: 10px;
    }
    .worksheet-btn {
      flex: 1; padding: 12px; border-radius: 8px; border: none;
      font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s;
    }
    .worksheet-btn.approve {
      background: #dcfce7; color: #15803d;
    }
    .worksheet-btn.approve:hover {
      background: #bbf7d0;
    }
    .worksheet-btn.reject {
      background: #fee2e2; color: #991b1b;
    }
    .worksheet-btn.reject:hover {
      background: #fecaca;
    }
    
    .empty-state {
      text-align: center; padding: 60px 20px; color: #94a3b8;
    }
    .empty-state-icon {
      font-size: 48px; margin-bottom: 15px;
    }
    .teacher-config-box { background: #fff; padding: 25px; border-radius: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .prompt-editor {
      width: 100%; height: 150px; padding: 15px; border: 2px solid #e2e8f0; border-radius: 12px;
      font-family: monospace; font-size: 14px; resize: vertical; line-height: 1.5;
      background: #f8fafc; color: #334155;
    }
    .prompt-editor:focus { border-color: #8b5cf6; background: #fff; outline: none; }

    /* ëŒ€ì‹œë³´ë“œ ì¹´ë“œ ê·¸ë¦¬ë“œ */
    .submission-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }
    .sub-card {
      background: white; border-radius: 16px; padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.02); border: 1px solid #e2e8f0;
      display: flex; flex-direction: column; gap: 12px; position: relative;
      transition: transform 0.2s;
    }
    .sub-card:hover { transform: translateY(-2px); box-shadow: 0 8px 16px rgba(0,0,0,0.05); }
    .sub-card.approved { border-top: 4px solid #8b5cf6; background: rgba(237, 233, 254, 0.5); }
    .sub-card.rejected { border-top: 4px solid #ef4444; }
    .sub-card.pending { border-top: 4px solid #f59e0b; }

    .sub-meta { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #f1f5f9; padding-bottom: 10px; }
    .sub-user { font-weight: 700; font-size: 16px; color: #0f172a; }
    .sub-badge { font-size: 11px; font-weight: 700; padding: 4px 10px; border-radius: 99px; text-transform: uppercase; }
    .badge-pending { background: #fffbeb; color: #b45309; }
    .badge-approved { background: #dcfce7; color: #15803d; }
    .badge-rejected { background: #fef2f2; color: #b91c1c; }

    .sub-body { font-size: 13px; color: #475569; display: flex; flex-direction: column; gap: 8px; }
    .sub-row label { font-size: 11px; font-weight: 700; color: #94a3b8; display: block; margin-bottom: 2px; }
    .sub-row p { margin: 0; line-height: 1.4; }

    .feedback-area { margin-top: auto; padding-top: 10px; border-top: 1px solid #f1f5f9; }
    .feedback-input { width: 100%; padding: 8px 12px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 13px; margin-bottom: 8px; }
    .action-group { display: flex; gap: 8px; }
    .action-btn { flex: 1; padding: 8px; border-radius: 6px; border: none; font-weight: 700; cursor: pointer; font-size: 12px; }
    .btn-approve { background: #dcfce7; color: #15803d; }
    .btn-reject { background: #fee2e2; color: #991b1b; }
    .btn-approve:hover { background: #bbf7d0; }
    .btn-reject:hover { background: #fecaca; }

    /* --- 3. í•™ìƒ ìº”ë²„ìŠ¤ UI --- */
    .app-inner { padding: 30px; position: relative; display: flex; flex-direction: column; height: 90vh; }
    
    /* ìƒë‹¨ ë°°ë„ˆ */
    .status-banner {
      background: linear-gradient(135deg, #0f172a, #1e293b); color: white; padding: 12px 20px;
      font-size: 14px; font-weight: 600; display: flex; justify-content: space-between; align-items: center;
      margin: -30px -30px 20px -30px; /* Full width */
    }
    .status-banner.approved { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
    .status-banner.rejected { background: linear-gradient(135deg, #ef4444, #dc2626); }
    .status-banner.pending { background: linear-gradient(135deg, #f59e0b, #eab308); }

    .header { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; }
    .header-icon { width: 44px; height: 44px; background: linear-gradient(135deg, #8b5cf6, #6366f1); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3); }
    .header h1 { margin: 0; font-size: 20px; font-weight: 800; color: #1e293b; }
    .user-tag { margin-left: auto; background: rgba(139, 92, 246, 0.1); color: #7c3aed; padding: 6px 12px; border-radius: 20px; font-size: 13px; font-weight: 700; border: 1px solid rgba(139, 92, 246, 0.2); }

    .scroll-area { flex: 1; overflow-y: auto; padding-right: 5px; padding-bottom: 20px; }

    /* ìŠ¤í… UI */
    .progress-nav { display: flex; gap: 5px; margin-bottom: 20px; }
    .prog-step { flex: 1; height: 6px; background: #e2e8f0; border-radius: 3px; position: relative; }
    .prog-step.active { background: linear-gradient(90deg, #8b5cf6, #6366f1); }
    .prog-step.done { background: #8b5cf6; }

    .step-container { display: none; animation: fadeIn 0.3s; }
    .step-container.active { display: block; }
    .design-section { display: block; animation: fadeIn 0.3s; }
    .step-header { margin-bottom: 15px; }
    .step-title { font-size: 18px; font-weight: 700; color: #1e293b; margin-bottom: 5px; }
    .step-desc { font-size: 14px; color: #64748b; }

    /* í¼ ìš”ì†Œ */
    .form-group { margin-bottom: 20px; }
    .label { font-size: 13px; font-weight: 700; color: #475569; margin-bottom: 6px; display: block; }
    .text-area { width: 100%; border: 2px solid #e2e8f0; border-radius: 12px; padding: 12px; font-size: 15px; resize: vertical; min-height: 100px; transition: border-color 0.2s; }
    .text-area:focus { outline: none; border-color: #8b5cf6; box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1); }
    .select-box { width: 100%; border: 2px solid #e2e8f0; border-radius: 12px; padding: 12px; font-size: 15px; background: white; }
    .input-line { width: 100%; border: 2px solid #e2e8f0; border-radius: 12px; padding: 12px; font-size: 15px; }

    /* ì˜ˆì‹œ ë²„íŠ¼ */
    .helper-btn { background: #fff7ed; color: #ea580c; border: 1px dashed #fdba74; padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 5px; margin-bottom: 15px; }
    .helper-btn:hover { background: #ffedd5; }

    /* ì±„íŒ… í”¼ë“œë°± */
    .chat-box { background: rgba(237, 233, 254, 0.5); border: 1px solid rgba(139, 92, 246, 0.2); border-radius: 16px; padding: 15px; margin-top: 20px; max-height: 300px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; display:none; }
    .chat-bubble { max-width: 90%; padding: 10px 14px; border-radius: 12px; font-size: 14px; line-height: 1.5; }
    .chat-ai { align-self: flex-start; background: #fff; border: 1px solid #cbd5e1; color: #334155; border-bottom-left-radius: 2px; }
    .chat-user { align-self: flex-end; background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; border-bottom-right-radius: 2px; }
    .chat-warn { background: #fef2f2; border: 1px solid #fecaca; color: #991b1b; align-self: flex-start; }
    .chat-success { background: #f0fdf4; border: 1px solid #bbf7d0; color: #166534; align-self: flex-start; }

    .bottom-nav { margin-top: auto; padding-top: 20px; border-top: 1px solid #f1f5f9; display: flex; justify-content: flex-end; gap: 10px; }
    .nav-btn { padding: 10px 24px; border-radius: 10px; font-weight: 700; border: none; cursor: pointer; font-size: 14px; transition: all 0.2s; }
    .btn-back { background: #f1f5f9; color: #64748b; }
    .btn-next { background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; box-shadow: 0 4px 6px rgba(139, 92, 246, 0.3); }
    .btn-check { background: linear-gradient(135deg, #6366f1, #4f46e5); color: white; box-shadow: 0 4px 6px rgba(99, 102, 241, 0.3); }
    .btn-submit { background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; box-shadow: 0 4px 6px rgba(139, 92, 246, 0.2); }
    .nav-btn:disabled { opacity: 0.5; cursor: not-allowed; }

    /* ì„¼ì„œ ê°€ì´ë“œ & ì¹´ë“œ */
    .sensor-tip { background: rgba(237, 233, 254, 0.6); border-left: 4px solid #8b5cf6; padding: 12px 16px; border-radius: 8px; font-size: 13px; color: #6d28d9; margin-bottom: 20px; line-height: 1.5; }
    .dual-cols { display: flex; gap: 15px; }
    .col-card { flex: 1; background: #fff; border: 1px solid #e2e8f0; border-radius: 12px; padding: 15px; }
    .col-header { font-size: 12px; font-weight: 700; text-transform: uppercase; margin-bottom: 8px; color: #64748b; }
    .col-card.on { border-top: 3px solid #8b5cf6; }
    .col-card.off { border-top: 3px solid #f59e0b; }

    @media (max-width: 600px) { .dual-cols { flex-direction: column; } }

    /* --- ì´ˆìŒíŒŒ ì„¼ì„œ í•™ìŠµ í˜ì´ì§€ ìŠ¤íƒ€ì¼ --- */
    .quiz-option-btn:hover { 
      background: rgba(248, 250, 252, 0.8) !important; 
      border-color: rgba(139, 92, 246, 0.3) !important; 
      transform: translateY(-2px);
    }
    .quiz-option-btn.correct { 
      background: rgba(236, 253, 245, 0.8) !important; 
      border-color: #8b5cf6 !important; 
      color: #7c3aed !important; 
    }
    .quiz-option-btn.wrong { 
      background: rgba(254, 242, 242, 0.8) !important; 
      border-color: #ef4444 !important; 
      color: #991b1b !important; 
    }

    /* --- ìƒë‹¨ ê³ ì • í™ˆ ë²„íŠ¼ ë„¤ë¹„ê²Œì´ì…˜ --- */
    .top-nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(139, 92, 246, 0.2);
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.1);
    }
    .top-nav.hidden { display: none; }
    .home-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: linear-gradient(135deg, #8b5cf6, #6366f1);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 2px 4px rgba(16, 185, 129, 0.3);
    }
    .home-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(16, 185, 129, 0.4);
      background: linear-gradient(135deg, #059669, #0284c7);
    }
    .top-nav-title {
      font-size: 14px;
      font-weight: 600;
      background: linear-gradient(135deg, #8b5cf6, #6366f1);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
  </style>
</head>
<body>

<!-- ìƒë‹¨ ê³ ì • í™ˆ ë„¤ë¹„ê²Œì´ì…˜ -->
<div id="top-nav" class="top-nav hidden">
  <div class="top-nav-title">SDGs Ã— ì´ˆìŒíŒŒ ì„¼ì„œ ë¬¸ì œí•´ê²° ì„¤ê³„ í”Œë«í¼</div>
  <button class="home-btn" onclick="showIntro()">
    ğŸ  í™ˆìœ¼ë¡œ
  </button>
</div>

<!-- VIEW 1: ì¸íŠ¸ë¡œ (ì—­í•  ì„ íƒ) -->
<div id="view-intro" class="view-section active">
  <div id="intro-screen">
    <!-- ë°°ê²½ì— ë‚ ì•„ë‹¤ë‹ˆëŠ” ë°•ì¥ë“¤ì´ ìƒì„±ë  ì»¨í…Œì´ë„ˆ -->
    <div id="bat-container"></div>
    
    <!-- ì¤‘ì•™ ì»¨í…ì¸  ë°•ìŠ¤ (ìœ ë¦¬ íš¨ê³¼) -->
    <div class="intro-content">
      <div class="main-icon">ğŸ¦‡</div>
      <h1 class="intro-title">SDGs Ã— ì´ˆìŒíŒŒ ì„¼ì„œ</h1>
      <p class="intro-subtitle">ì„¸ìƒì„ ë°”ê¾¸ëŠ” ì•„ì´ë””ì–´, AIì™€ í•¨ê»˜ ì„¤ê³„í•´ë³´ì„¸ìš”.</p>
    
    <div class="role-cards">
      <div class="role-card" onclick="goToStudentLogin()">
          <span class="role-icon">ğŸ‘¨â€ğŸ“</span>
        <div class="role-name">í•™ìƒ (Student)</div>
          <div class="role-desc">ì•„ì´ë””ì–´ ì„¤ê³„ ë° ì œì¶œ</div>
      </div>
      <div class="role-card" onclick="goToTeacherLogin()">
          <span class="role-icon">ğŸ‘©â€ğŸ«</span>
        <div class="role-name">êµì‚¬ (Teacher)</div>
          <div class="role-desc">ì œì¶œ í˜„í™© ë° í‰ê°€</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- VIEW 2-S: í•™ìƒ ë¡œê·¸ì¸ -->
<div id="view-student-login" class="view-section">
  <div class="intro-wrap">
    <h2 class="intro-title">í•™ìƒ ë¡œê·¸ì¸</h2>
    <div class="login-box">
      <label class="input-label">í•™ë²ˆ (Class ID)</label>
      <input type="text" id="std-id" class="input-field" placeholder="ì˜ˆ: 20125">
      <label class="input-label">ì´ë¦„ (Name)</label>
      <input type="text" id="std-name" class="input-field" placeholder="ì˜ˆ: ê¹€ì½”ë”©">
      <button class="btn-primary" onclick="studentLogin()">ì‹œì‘í•˜ê¸°</button>
      <div style="text-align:center;">
        <button class="btn-text" onclick="showIntro()">ë’¤ë¡œ ê°€ê¸°</button>
      </div>
    </div>
  </div>
</div>

<!-- VIEW 2-T: êµì‚¬ ë¡œê·¸ì¸ -->
<div id="view-teacher-login" class="view-section">
  <div class="intro-wrap">
    <h2 class="intro-title">êµì‚¬ ë¡œê·¸ì¸</h2>
    <div class="login-box">
      <label class="input-label">ë¹„ë°€ë²ˆí˜¸ (Password)</label>
      <input type="password" id="tea-pw" class="input-field" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
      <button class="btn-primary" onclick="teacherLogin()">ë¡œê·¸ì¸</button>
      <div style="text-align:center;">
        <button class="btn-text" onclick="showIntro()">ë’¤ë¡œ ê°€ê¸°</button>
      </div>
    </div>
  </div>
</div>

<!-- VIEW 3-T: êµì‚¬ ëŒ€ì‹œë³´ë“œ -->
<div id="view-teacher-dashboard" class="view-section" style="max-width:1400px;">
  <div class="dash-header">
    <div class="dash-title">ğŸ“Š êµì‚¬ ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</div>
    <div class="dash-controls">
      <button class="btn-sm" onclick="goToTeacherConfig()">âš™ï¸ í‰ê°€ ê¸°ì¤€ ì„¤ì •</button>
      <button class="btn-sm danger" onclick="clearData()">ğŸ—‘ï¸ ë°ì´í„° ì´ˆê¸°í™”</button>
      <button class="btn-sm" onclick="showIntro()">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </div>
  
  <!-- íƒ­ ë©”ë‰´ -->
  <div class="teacher-tabs">
    <button class="teacher-tab active" onclick="switchTeacherTab('class')">í•™ê¸‰ë³„ ê´€ë¦¬</button>
    <button class="teacher-tab" onclick="switchTeacherTab('student')">í•™ìƒë³„ ê´€ë¦¬</button>
  </div>
  
  <!-- í•™ê¸‰ë³„ ê´€ë¦¬ ë·° -->
  <div id="class-management-view" class="management-layout" style="display: flex;">
    <div class="class-list-panel">
      <div class="class-list-header">
        <span class="class-list-title">í•™ê¸‰ ëª©ë¡</span>
        <button class="btn-add-class" onclick="showAddClassDialog()" title="í•™ê¸‰ ì¶”ê°€">+</button>
      </div>
      <div id="class-list-container">
        <!-- í•™ê¸‰ ëª©ë¡ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
      </div>
    </div>
    <div class="student-list-panel">
      <div class="student-list-header">í•™ìƒ ëª©ë¡</div>
      <div id="student-list-container">
        <!-- ì„ íƒëœ í•™ê¸‰ì˜ í•™ìƒ ëª©ë¡ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
      </div>
    </div>
    <div class="student-content-panel">
      <div id="student-worksheet-container">
        <!-- ì„ íƒëœ í•™ìƒì˜ í•™ìŠµì§€ê°€ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
      </div>
    </div>
  </div>
  
  <!-- í•™ìƒë³„ ê´€ë¦¬ ë·° -->
  <div id="student-management-view" class="management-layout" style="display: none;">
    <div class="student-list-panel" style="width: 320px;">
      <div class="student-list-header">ì „ì²´ í•™ìƒ</div>
      <div id="all-student-list-container">
        <!-- ì „ì²´ í•™ìƒ ëª©ë¡ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
      </div>
    </div>
    <div class="student-content-panel">
      <div id="all-student-worksheet-container">
        <!-- ì„ íƒëœ í•™ìƒì˜ í•™ìŠµì§€ê°€ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
      </div>
    </div>
  </div>
</div>

<!-- VIEW 4-T: êµì‚¬ ì„¤ì • (í”„ë¡¬í”„íŠ¸) -->
<div id="view-teacher-config" class="view-section">
  <div class="intro-wrap" style="max-width:800px;">
    <h2 class="intro-title">âš™ï¸ AI í‰ê°€ ê¸°ì¤€ ì„¤ì •</h2>
    <p class="intro-desc">í•™ìƒë“¤ì´ [ê²€ì‚¬] ë²„íŠ¼ì„ ëˆ„ë¥¼ ë•Œ, AIê°€ ì°¸ê³ í•  í‰ê°€ ê¸°ì¤€ì…ë‹ˆë‹¤.</p>
    
    <div class="teacher-config-box" style="text-align:left;">
      <label class="input-label">ğŸ”‘ OpenAI API í‚¤ (ì„ íƒì‚¬í•­ - ì„¤ì • ì‹œ AI í”¼ë“œë°± í™œì„±í™”)</label>
      <input type="password" id="api-key" class="input-field" placeholder="sk-..." style="margin-bottom:15px;">
      <small style="color:#64748b; font-size:12px;">â€» API í‚¤ë¥¼ ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ ê²€ì¦ë§Œ ìˆ˜í–‰ë©ë‹ˆë‹¤. OpenAI API í‚¤ëŠ” ë°±ì—”ë“œ ì„œë²„ë¥¼ í†µí•´ ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.</small>
      
      <label class="input-label" style="margin-top:20px;">ğŸ“ AI í˜ë¥´ì†Œë‚˜ ë° í‰ê°€ ê°€ì´ë“œ</label>
      <textarea id="teacher-prompt" class="prompt-editor">
ë‹¹ì‹ ì€ SDGs êµìœ¡ ì „ë¬¸ê°€ì´ì ì°½ì˜ì  ë¬¸ì œí•´ê²° ì½”ì¹˜ì…ë‹ˆë‹¤. í•™ìƒì˜ ì„¤ê³„ë¥¼ ë‹¤ìŒ ê¸°ì¤€ìœ¼ë¡œ í‰ê°€í•˜ê³  ì¹œì ˆí•˜ê²Œ í”¼ë“œë°±í•´ì£¼ì„¸ìš”.

[í‰ê°€ ê¸°ì¤€ - ê° í•­ëª©ë³„ë¡œ êµ¬ì²´ì ìœ¼ë¡œ í‰ê°€]

1. **ì‹¤í˜„ ê°€ëŠ¥ì„± (Feasibility)**
   - ì´ˆìŒíŒŒ ì„¼ì„œì˜ ê¸°ìˆ ì  í•œê³„ë¥¼ ì •í™•íˆ ì´í•´í–ˆëŠ”ê°€? (ê±°ë¦¬ë§Œ ì¸¡ì • ê°€ëŠ¥, ë¬¼ì²´ ì¢…ë¥˜ êµ¬ë³„ ë¶ˆê°€)
   - ì œì•ˆí•œ í•´ê²°ì±…ì´ ì‹¤ì œë¡œ êµ¬í˜„ ê°€ëŠ¥í•œ ìˆ˜ì¤€ì¸ê°€?
   - ì‚¬ìš©í•œ ê±°ë¦¬ ê¸°ì¤€ì´ í•©ë¦¬ì ì¸ê°€?
   - ì˜ˆìƒë˜ëŠ” ê¸°ìˆ ì  ë¬¸ì œì ì€ ë¬´ì—‡ì¸ê°€?

2. **SDGs ê´€ë ¨ì„± (Relevance)**
   - ì„ íƒí•œ SDGs ëª©í‘œì™€ ë¬¸ì œ í•´ê²° ë°©ë²•ì´ ì‹¤ì œë¡œ ì—°ê´€ì´ ìˆëŠ”ê°€?
   - ì´ í•´ê²°ì±…ì´ ëª©í‘œ ë‹¬ì„±ì— ì–´ë–»ê²Œ ê¸°ì—¬í•˜ëŠ”ì§€ ëª…í™•í•œê°€?
   - êµ¬ì²´ì ì¸ ì˜í–¥ë ¥(ì˜ˆ: ë¬¼ ì ˆì•½ëŸ‰, ì—ë„ˆì§€ ì ˆê°ë¥  ë“±)ì„ ê³ ë ¤í–ˆëŠ”ê°€?

3. **êµ¬ì²´ì„± ë° ëª…í™•ì„± (Specificity)**
   - IF-THEN ì¡°ê±´ì´ ì½”ë”© ê°€ëŠ¥í•  ì •ë„ë¡œ êµ¬ì²´ì ì¸ê°€?
   - ì„¼ì„œ ë°°ì¹˜ ìœ„ì¹˜ì™€ ì‘ë™ ì¡°ê±´ì´ ëª…í™•í•œê°€?
   - ì¥ì¹˜ì˜ ON/OFF ë™ì‘ì´ ë…¼ë¦¬ì ìœ¼ë¡œ ì—°ê²°ë˜ì–´ ìˆëŠ”ê°€?
   - ì˜ˆì™¸ ìƒí™©(ì„¼ì„œ ì˜¤ì‘ë™, ì—¬ëŸ¬ ì‚¬ëŒ ë™ì‹œ ì‚¬ìš© ë“±)ì„ ê³ ë ¤í–ˆëŠ”ê°€?

4. **ì•ˆì „ì„± ë° ì‹¤ìš©ì„± (Safety & Practicality)**
   - ì¥ì¹˜ ì‘ë™ ì‹œ ì•ˆì „ ìœ„í—˜ì´ ì—†ëŠ”ê°€?
   - ì‹¤ì œ ì‚¬ìš© í™˜ê²½ì—ì„œ ì‹¤ìš©ì ì¼ ìˆ˜ ìˆëŠ”ê°€?
   - ìœ ì§€ë³´ìˆ˜ì™€ ê´€ë¦¬ê°€ ê°€ëŠ¥í•œê°€?

5. **ì°½ì˜ì„± ë° ê°œì„ ì  (Creativity & Improvements)**
   - ë¬¸ì œì— ëŒ€í•œ ìƒˆë¡œìš´ ê´€ì ì´ë‚˜ ì°½ì˜ì  ì ‘ê·¼ì´ ìˆëŠ”ê°€?
   - ë” íš¨ê³¼ì ì¸ ë°©ë²•ì€ ë¬´ì—‡ì´ ìˆì„ê¹Œ?
   - ì¶”ê°€ë¡œ ê³ ë ¤í•˜ë©´ ì¢‹ì„ ì ì€?

[í”¼ë“œë°± ì‘ì„± ê°€ì´ë“œ]
- í•™ìƒ ì´ë¦„ì„ ë¶€ë¥´ë©° ì¹œì ˆí•˜ê³  ê²©ë ¤í•˜ëŠ” í†¤ìœ¼ë¡œ ì‘ì„±
- ë¨¼ì € ì˜í•œ ì ì„ 2-3ê°œ êµ¬ì²´ì ìœ¼ë¡œ ì–¸ê¸‰
- ê° í‰ê°€ ê¸°ì¤€ë³„ë¡œ ê°œì„ í•  ì ì„ êµ¬ì²´ì ìœ¼ë¡œ ì œì‹œ
- ì •ë‹µì„ ì•Œë ¤ì£¼ê¸°ë³´ë‹¤ ìŠ¤ìŠ¤ë¡œ ìƒê°í•  ìˆ˜ ìˆëŠ” ì§ˆë¬¸ ë˜ì§€ê¸°
- SDGs ëª©í‘œ ë‹¬ì„±ì— ëŒ€í•œ ì˜í–¥ë ¥ì„ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…
- ì‹¤í˜„ ê°€ëŠ¥ì„±ì„ ë†’ì´ê¸° ìœ„í•œ ì‹¤ìš©ì  ì œì•ˆ
- ë§ˆë¬´ë¦¬ëŠ” ê¸ì •ì ì¸ ê²©ë ¤ì™€ í•¨ê»˜ ë‹¤ìŒ ë‹¨ê³„ ì œì‹œ

[í”¼ë“œë°± í˜•ì‹]
âœ… ì˜í•œ ì : [êµ¬ì²´ì  ë‚´ìš©]
ğŸ’¡ ê°œì„ í•˜ë©´ ì¢‹ì„ ì : [êµ¬ì²´ì  ë‚´ìš©]
ğŸ¯ SDGs ê´€ë ¨ì„±: [êµ¬ì²´ì  ì„¤ëª…]
âš™ï¸ ì‹¤í˜„ ê°€ëŠ¥ì„±: [êµ¬ì²´ì  í‰ê°€]
ğŸš€ ë‹¤ìŒ ë‹¨ê³„: [êµ¬ì²´ì  ì œì•ˆ]
      </textarea>
    </div>
    <br>
    <button class="btn-primary" onclick="saveTeacherConfig()">ì €ì¥í•˜ê³  ëŒì•„ê°€ê¸°</button>
    <button class="btn-text" onclick="showDashboard()">ì·¨ì†Œ</button>
  </div>
</div>

<!-- VIEW 5-S-L: í•™ìƒ ì´ˆìŒíŒŒ ì„¼ì„œ ì›ë¦¬ í•™ìŠµ -->
<div id="view-student-learning" class="view-section">
  <div class="app-inner" style="max-height: 90vh; overflow-y: auto;">
    <div class="header" style="margin-bottom: 20px;">
      <div class="header-icon">ğŸ¦‡</div>
      <h1>ì´ˆìŒíŒŒ ì„¼ì„œ ì›ë¦¬ ì´í•´</h1>
      <div class="user-tag" id="learning-user-display">í•™ìƒ</div>
      <button onclick="goToDesignPage()" style="margin-left: auto; padding: 10px 20px; background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 6px rgba(139, 92, 246, 0.3); transition: all 0.2s;">
        ì•„ì´ë””ì–´ ì„¤ê³„í•˜ëŸ¬ ê°€ê¸° â†’
      </button>
    </div>
    
    <!-- í•™ìŠµ ì™„ë£Œ ë°°ì§€ -->
    <div id="learning-completed-badge" style="display: none; background: rgba(237, 233, 254, 0.8); border: 2px solid #8b5cf6; border-radius: 12px; padding: 15px; margin-bottom: 20px; text-align: center;">
      <div style="font-size: 18px; font-weight: 700; color: #7c3aed; margin-bottom: 5px;">âœ… í•™ìŠµ ì™„ë£Œ!</div>
      <div style="font-size: 14px; color: #6d28d9;">ì´ë¯¸ í•™ìŠµì„ ì™„ë£Œí•˜ì…¨ìŠµë‹ˆë‹¤. ë‚´ìš©ì„ ë‹¤ì‹œ í™•ì¸í•˜ê±°ë‚˜ ì•„ì´ë””ì–´ ì„¤ê³„ í˜ì´ì§€ë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
    </div>

    <div style="margin-bottom: 20px;">
      <div style="background: rgba(237, 233, 254, 0.6); border: 2px solid #8b5cf6; border-radius: 16px; padding: 20px; text-align: left; width: 100%;">
        <strong style="color: #6d28d9; font-size: 16px;">ğŸ’¡ ê¸°ìˆ ì  ì›ë¦¬ ì´í•´:</strong><br>
        <div style="margin-top: 10px; color: #6d28d9; line-height: 1.8;">
          1. ë°•ì¥ê°€ ë‚˜ë°©ì„ ë‚šì•„ì±„ëŠ” ê±°ë¦¬ëŠ” ì•½ <strong>2~5m</strong>ì…ë‹ˆë‹¤.<br>
          2. <strong>HC-SR04 ì´ˆìŒíŒŒ ì„¼ì„œ</strong>ì˜ ì¸¡ì • ë²”ìœ„ëŠ” <strong>2cm ~ 400cm(4m)</strong>ì´ë©°, ì´ ë²”ìœ„ ì•ˆì—ì„œ ê°€ì¥ ì •í™•í•˜ê²Œ ê±°ë¦¬ë¥¼ ì´ ìˆ˜ ìˆì–´ìš”!
        </div>
      </div>
    </div>

    <!-- ì‹œë®¬ë ˆì´ì…˜ ì˜ì—­ -->
    <div style="background: rgba(248, 250, 252, 0.8); border: 2px solid rgba(139, 92, 246, 0.2); border-radius: 20px; padding: 30px; margin-bottom: 30px;">
      <div id="sim-visual" style="width: 100%; height: 350px; background: white; border-radius: 16px; position: relative; overflow: hidden; border: 2px solid rgba(139, 92, 246, 0.3); margin-bottom: 20px; display: flex; align-items: center;">
        <!-- ë°•ì¥ ë§í’ì„  -->
        <div id="bat-speech-bubble" style="position: absolute; left: 180px; top: 25%; z-index: 15; opacity: 1; transition: opacity 0.3s ease; transform: translateY(0);">
          <div id="bat-bubble-container" style="background: linear-gradient(135deg, #fef3c7, #fde68a); border: 2px solid #f59e0b; border-radius: 16px; padding: 12px 18px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); position: relative; max-width: 250px; animation: bubbleFloat 2s ease-in-out infinite;">
            <div id="bat-speech-text" style="font-size: 14px; font-weight: 600; color: #92400e; line-height: 1.4; text-align: center;">
              ìŒ... ì•„ì§ì€ ì¢€ ë¨¼ë°? (íƒìƒ‰ ì¤‘)
            </div>
            <!-- ë§í’ì„  ê¼¬ë¦¬ -->
            <div id="bat-tail-outer" style="position: absolute; left: -10px; top: 50%; transform: translateY(-50%); width: 0; height: 0; border-top: 10px solid transparent; border-bottom: 10px solid transparent; border-right: 12px solid #f59e0b;"></div>
            <div id="bat-tail-inner" style="position: absolute; left: -8px; top: 50%; transform: translateY(-50%); width: 0; height: 0; border-top: 8px solid transparent; border-bottom: 8px solid transparent; border-right: 10px solid #fde68a;"></div>
          </div>
        </div>
        <div id="sim-bat" style="position: absolute; left: 50px; font-size: 80px; z-index: 10; top: 50%; transform: translateY(-50%); animation: batHover 2s ease-in-out infinite;">ğŸ¦‡</div>
        <div id="sim-moth" style="position: absolute; right: 10%; font-size: 60px; transition: right 0.3s; z-index: 10; top: 50%; transform: translateY(-50%);">ğŸ¦‹</div>
        <div id="wave-ping" style="position: absolute; width: 60px; height: 60px; border-radius: 50%; opacity: 0; z-index: 5; top: 50%; transform: translateY(-50%); left: 90px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; border: 3px solid #6366f1; background: rgba(99, 102, 241, 0.2); color: #4f46e5;">Ping</div>
        <div id="wave-pong" style="position: absolute; width: 60px; height: 60px; border-radius: 50%; opacity: 0; z-index: 5; top: 50%; transform: translateY(-50%); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; border: 3px solid #8b5cf6; background: rgba(139, 92, 246, 0.2); color: #7c3aed;">Pong</div>
        <div style="position: absolute; bottom: 10px; left: 100px; right: 100px; height: 30px; border-top: 2px solid #94a3b8; display: flex; justify-content: space-between; font-size: 11px; color: #64748b; padding-top: 5px;">
          <span>0cm</span><span>100cm</span><span>200cm</span><span>300cm</span><span>400cm</span>
        </div>
      </div>

      <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">
        <div style="flex: 1; min-width: 300px;">
          <label style="font-weight: bold; font-size: 14px; color: #7c3aed; display: block; margin-bottom: 8px;">ê±°ë¦¬ ì¡°ì ˆ (2cm ~ 400cm)</label>
          <input type="range" id="dist-slider" min="2" max="400" value="400" style="width: 100%; cursor: pointer;" oninput="updateSimDistance(this.value)">
        </div>
        <div style="display: flex; gap: 15px;">
          <div style="background: white; padding: 8px 20px; border-radius: 12px; border: 2px solid rgba(139, 92, 246, 0.3); font-weight: bold; font-size: 16px; color: #7c3aed;" id="disp-distance">400cm</div>
          <div style="background: white; padding: 8px 20px; border-radius: 12px; border: 2px solid rgba(239, 68, 68, 0.3); font-weight: bold; font-size: 16px; color: #dc2626;" id="disp-time">23,529Î¼s</div>
        </div>
        <button onclick="fireWave()" style="padding: 12px 30px; background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 6px rgba(139, 92, 246, 0.3); transition: all 0.2s;">
          ğŸ“¡ ë°œì‚¬!
        </button>
      </div>
    </div>

    <!-- í€´ì¦ˆ ì˜ì—­ -->
    <div style="background: rgba(255, 251, 235, 0.8); border: 2px solid #f59e0b; border-radius: 16px; padding: 25px; margin-bottom: 20px;">
      <div style="font-size: 18px; font-weight: 800; color: #92400e; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
        â“ <strong>ê°œë… ì²´í¬:</strong> ì´ˆìŒíŒŒ ì„¼ì„œë¡œ ì•Œ ìˆ˜ ìˆëŠ” ê²ƒì€?
      </div>
      <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;">
        <button class="quiz-option-btn" onclick="checkQuizAnswer(this, false, 'color')" style="flex: 1; min-width: 150px; padding: 15px; border: 2px solid #e2e8f0; background: white; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; color: #475569;">
          ë¬¼ì²´ì˜ ìƒ‰ê¹”
        </button>
        <button class="quiz-option-btn" onclick="checkQuizAnswer(this, false, 'type')" style="flex: 1; min-width: 150px; padding: 15px; border: 2px solid #e2e8f0; background: white; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; color: #475569;">
          ë¬¼ì²´ì˜ ì¢…ë¥˜
        </button>
        <button class="quiz-option-btn" onclick="checkQuizAnswer(this, true, 'distance')" style="flex: 1; min-width: 150px; padding: 15px; border: 2px solid #e2e8f0; background: white; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; color: #475569;">
          ë¬¼ì²´ê¹Œì§€ì˜ ê±°ë¦¬
        </button>
        <button class="quiz-option-btn" onclick="checkQuizAnswer(this, false, 'sound')" style="flex: 1; min-width: 150px; padding: 15px; border: 2px solid #e2e8f0; background: white; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; color: #475569;">
          ì†Œë¦¬ ì¸¡ì •
        </button>
      </div>
      <div id="quiz-feedback" style="margin-top: 15px; font-size: 14px; font-weight: bold; padding: 12px; border-radius: 12px; display: none;"></div>
    </div>

    <!-- ë°°ìš´ ì  ì •ë¦¬ (ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë¹ˆì¹¸ ì±„ìš°ê¸°) -->
    <div style="margin-bottom: 20px;">
      <div style="font-weight: bold; color: #8b5cf6; font-size: 18px; display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
        âœ¨ <strong>[í•µì‹¬ ìš”ì•½] ë‹¨ì–´ë¥¼ ëŒì–´ë„£ì–´ ì™„ì„±í•˜ì„¸ìš”!</strong>
      </div>
      <div style="color: #64748b; font-size: 14px; margin-bottom: 15px; display: flex; align-items: center; gap: 5px;">
        ğŸ–±ï¸ ì•„ë˜ ë‹¨ì–´ë¥¼ ë§ˆìš°ìŠ¤ë¡œ ëŒì–´ì„œ ë¹ˆì¹¸ì— ë„£ì–´ë³´ì„¸ìš”.
      </div>
      
      <div style="background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%); border: 2px solid #a78bfa; border-radius: 20px; padding: 30px; margin-bottom: 15px; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.15);">
        <!-- ìƒë‹¨ ì ì„  ì˜ì—­ - ë“œë˜ê·¸ ê°€ëŠ¥í•œ ë‹¨ì–´ ë²„íŠ¼ë“¤ -->
        <div style="border: 2px dashed #a78bfa; border-radius: 16px; padding: 25px; margin-bottom: 30px; background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px);">
          <div id="word-container" style="display: flex; gap: 12px; flex-wrap: wrap; justify-content: center;">
            <div class="drag-word" draggable="true" data-word="ì´ˆìŒíŒŒ" style="background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; padding: 12px 28px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: grab; user-select: none; box-shadow: 0 4px 8px rgba(139, 92, 246, 0.3); transition: all 0.3s ease;">
              ì´ˆìŒíŒŒ
            </div>
            <div class="drag-word" draggable="true" data-word="ë°˜ì‚¬" style="background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; padding: 12px 28px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: grab; user-select: none; box-shadow: 0 4px 8px rgba(139, 92, 246, 0.3); transition: all 0.3s ease;">
              ë°˜ì‚¬
            </div>
            <div class="drag-word" draggable="true" data-word="ì‹œê°„" style="background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; padding: 12px 28px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: grab; user-select: none; box-shadow: 0 4px 8px rgba(139, 92, 246, 0.3); transition: all 0.3s ease;">
              ì‹œê°„
            </div>
            <div class="drag-word" draggable="true" data-word="ê±°ë¦¬" style="background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; padding: 12px 28px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: grab; user-select: none; box-shadow: 0 4px 8px rgba(139, 92, 246, 0.3); transition: all 0.3s ease;">
              ê±°ë¦¬
            </div>
          </div>
        </div>
        
        <!-- ë¹ˆì¹¸ì´ ìˆëŠ” ë¬¸ì¥ -->
        <div style="font-size: 18px; line-height: 2.4; color: #1e293b; text-align: left; padding: 15px 0;">
          ì´ˆìŒíŒŒ ì„¼ì„œëŠ” 
          <span class="drop-zone" id="drop1" data-correct="ì´ˆìŒíŒŒ" style="display: inline-block; min-width: 100px; padding: 8px 12px; border: 2px dashed #c4b5fd; border-radius: 8px; background: white; margin: 0 5px; vertical-align: middle; text-align: center;"></span>
          ë¥¼ ì˜ê³ , ë¬¼ì²´ì— 
          <span class="drop-zone" id="drop2" data-correct="ë°˜ì‚¬" style="display: inline-block; min-width: 100px; padding: 8px 12px; border: 2px dashed #c4b5fd; border-radius: 8px; background: white; margin: 0 5px; vertical-align: middle; text-align: center;"></span>
          ë˜ì–´ ëŒì•„ì˜¤ëŠ” 
          <span class="drop-zone" id="drop3" data-correct="ì‹œê°„" style="display: inline-block; min-width: 100px; padding: 8px 12px; border: 2px dashed #c4b5fd; border-radius: 8px; background: white; margin: 0 5px; vertical-align: middle; text-align: center;"></span>
          ìœ¼ë¡œ 
          <span class="drop-zone" id="drop4" data-correct="ê±°ë¦¬" style="display: inline-block; min-width: 100px; padding: 8px 12px; border: 2px dashed #c4b5fd; border-radius: 8px; background: white; margin: 0 5px; vertical-align: middle; text-align: center;"></span>
          ë¥¼ ì¸¡ì •í•©ë‹ˆë‹¤.
        </div>
      </div>
      
      <!-- ë‹¤ì‹œí•˜ê¸° ë° ì •ë‹µ í™•ì¸ ë²„íŠ¼ -->
      <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 15px;">
        <button onclick="resetDragDrop()" style="padding: 12px 28px; background: #64748b; color: white; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 6px rgba(100, 116, 139, 0.2);">
          ë‹¤ì‹œí•˜ê¸°
        </button>
        <button onclick="checkDragDropAnswer()" style="padding: 12px 28px; background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4); transition: all 0.3s ease;">
          ì •ë‹µ í™•ì¸
        </button>
      </div>
      
      <div id="reflection-feedback" style="margin-top: 15px; font-size: 14px; font-weight: bold; padding: 12px; border-radius: 12px; display: none;"></div>
    </div>

    <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid rgba(139, 92, 246, 0.2);">
      <button onclick="completeLearning()" style="padding: 15px 50px; font-size: 1.1rem; font-weight: bold; color: white; background: linear-gradient(135deg, #8b5cf6, #6366f1); border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 10px 20px rgba(139, 92, 246, 0.3); transition: transform 0.2s;">
        ì›ë¦¬ ì´í•´ ì™„ë£Œ! ì„¤ê³„í•˜ëŸ¬ ê°€ê¸° ğŸ‘‰
      </button>
    </div>
  </div>
</div>

<!-- VIEW 5-S: í•™ìƒ ë©”ì¸ ìº”ë²„ìŠ¤ -->
<div id="view-student-main" class="view-section">
  <div class="app-inner">
    <!-- ìƒíƒœ ë°°ë„ˆ -->
    <div id="status-banner" class="status-banner" style="display:none;">
      <span id="status-msg">ìƒíƒœ ë©”ì‹œì§€</span>
      <span id="status-label" style="background:rgba(255,255,255,0.2); padding:4px 10px; border-radius:12px; font-size:12px;"></span>
    </div>

    <div class="header">
      <div class="header-icon">ğŸ¦‡</div>
      <h1>SDGs ë¬¸ì œí•´ê²° ì„¤ê³„</h1>
      <div class="user-tag" id="user-display">í•™ìƒ</div>
    </div>

    <div class="scroll-area">
      <!-- ì„¤ê³„ í¼ ì „ì²´ -->
      <div id="design-form-container">
        <button class="helper-btn" onclick="loadExample()" style="margin-bottom: 20px;">ğŸ² ì˜ˆì‹œ ë¶ˆëŸ¬ì˜¤ê¸° (ë”°ë¼ ì“°ê¸° ê¸ˆì§€!)</button>
        
        <!-- STEP 1: ë¬¸ì œ ë°œê²¬ & ëª©í‘œ ì„¤ì • -->
        <div class="design-section" style="margin-bottom: 40px; padding-bottom: 30px; border-bottom: 2px solid #e2e8f0;">
        <div class="step-header">
          <div class="step-title">1. ë¬¸ì œ ë°œê²¬ & ëª©í‘œ ì„¤ì •</div>
          <div class="step-desc">ì–´ë–¤ ë¶ˆí¸í•¨ì„ í•´ê²°í•˜ê³  ì‹¶ë‚˜ìš”? SDGs ëª©í‘œì™€ ì—°ê²°í•´ë³´ì„¸ìš”.</div>
        </div>
        
        <div class="form-group">
          <label class="label">â‘  í•´ê²°í•˜ê³  ì‹¶ì€ ë¬¸ì œ</label>
          <textarea id="inp-problem" class="text-area" placeholder="ì˜ˆ: ë³µë„ì— ì‚¬ëŒì´ ì—†ëŠ”ë°ë„ ë¶ˆì´ ì¼œì ¸ ìˆì–´ ì „ê¸°ê°€ ë‚­ë¹„ë¼ìš”."></textarea>
        </div>
        <div class="form-group">
          <label class="label">â‘¡ ê´€ë ¨ SDGs ëª©í‘œ</label>
          <select id="inp-sdg" class="select-box">
            <option value="">ëª©í‘œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
            <option value="3">Goal 3. ê±´ê°•ê³¼ ì›°ë¹™</option>
            <option value="4">Goal 4. ì–‘ì§ˆì˜ êµìœ¡</option>
            <option value="6">Goal 6. ê¹¨ë—í•œ ë¬¼ê³¼ ìœ„ìƒ</option>
            <option value="7">Goal 7. ì—ë„ˆì§€</option>
            <option value="11">Goal 11. ì§€ì†ê°€ëŠ¥í•œ ë„ì‹œ</option>
            <option value="12">Goal 12. ì±…ì„ìˆëŠ” ì†Œë¹„</option>
            <option value="13">Goal 13. ê¸°í›„ í–‰ë™</option>
            <option value="14">Goal 14. í•´ì–‘ ìƒíƒœê³„</option>
            <option value="15">Goal 15. ìœ¡ìƒ ìƒíƒœê³„</option>
          </select>
        </div>
      </div>

        <!-- STEP 2: ì„¼ì„œ ê°ì§€ ì¡°ê±´ -->
        <div class="design-section" style="margin-bottom: 40px; padding-bottom: 30px; border-bottom: 2px solid #e2e8f0;">
        <div class="step-header">
          <div class="step-title">2. ì„¼ì„œ ê°ì§€ ì¡°ê±´ (Input)</div>
          <div class="step-desc">ì´ˆìŒíŒŒ ì„¼ì„œê°€ 'ì–¸ì œ' ì‘ë™í• ì§€ ê±°ë¦¬ë¥¼ ì •í•´ì£¼ì„¸ìš”.</div>
        </div>
        <div class="sensor-tip">
          <strong>ğŸ¦‡ ì´ˆìŒíŒŒ ì„¼ì„œ í•µì‹¬:</strong> ì˜¤ì§ <strong>"ê±°ë¦¬(cm)"</strong>ë§Œ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
          *ì†Œë¦¬, ë¹›, ëƒ„ìƒˆ, ë¬¼ì²´ì˜ ì¢…ë¥˜(ì‚¬ëŒ vs ê°•ì•„ì§€)ëŠ” êµ¬ë³„í•˜ì§€ ëª»í•´ìš”.
        </div>
        
        <div class="form-group">
          <label class="label">â‘  ê¸°ì¤€ ê±°ë¦¬ (Threshold)</label>
          <input type="number" id="inp-dist" class="input-line" placeholder="ì˜ˆ: 30 (ë‹¨ìœ„: cm)">
        </div>
        <div class="form-group">
          <label class="label">â‘¡ ê°€ê¹Œì›Œì¡Œì„ ë•Œ (IF ê±°ë¦¬ &lt; ê¸°ì¤€)</label>
          <textarea id="inp-cond-on" class="text-area" placeholder="ì˜ˆ: ë¬¼ì²´ì™€ì˜ ê±°ë¦¬ê°€ 30cm ì´ë‚´ê°€ ë˜ë©´"></textarea>
        </div>
        <div class="form-group">
          <label class="label">â‘¢ ë©€ì–´ì¡Œì„ ë•Œ (ELSE ê±°ë¦¬ â‰¥ ê¸°ì¤€)</label>
          <textarea id="inp-cond-off" class="text-area" placeholder="ì˜ˆ: ë¬¼ì²´ê°€ 30cm ì´ìƒ ë©€ì–´ì§€ë©´"></textarea>
        </div>
      </div>

        <!-- STEP 3: ì¥ì¹˜ ë°˜ì‘ ì„¤ê³„ -->
        <div class="design-section" style="margin-bottom: 40px; padding-bottom: 30px; border-bottom: 2px solid #e2e8f0;">
        <div class="step-header">
          <div class="step-title">3. ì¥ì¹˜ ë°˜ì‘ ì„¤ê³„ (Output)</div>
          <div class="step-desc">ì¡°ê±´ì— ë”°ë¼ ì–´ë–¤ ì¥ì¹˜ê°€ ì–´ë–»ê²Œ ì›€ì§ì¼ì§€ ì •í•´ì£¼ì„¸ìš”.</div>
        </div>

        <div class="dual-cols">
          <div class="col-card on">
            <div class="col-header">ğŸŸ¢ ON (ì‘ë™)</div>
            <select id="inp-dev-on" class="select-box" style="margin-bottom:10px;">
              <option value="led">ğŸ’¡ LED ì¼œê¸°</option>
              <option value="servo">ğŸšª ì„œë³´ëª¨í„° ì—´ê¸°</option>
              <option value="speaker">ğŸ”Š ì†Œë¦¬ ì¼œê¸°</option>
              <option value="motor">ğŸŒ€ ëª¨í„° ì¼œê¸°</option>
            </select>
            <input type="text" id="inp-act-on" class="input-line" placeholder="ìƒì„¸ ë™ì‘ (ì˜ˆ: 90ë„ íšŒì „)">
          </div>
          <div class="col-card off">
            <div class="col-header">ğŸŸ  OFF (ë³µêµ¬)</div>
            <select id="inp-dev-off" class="select-box" style="margin-bottom:10px;">
              <option value="led">ğŸŒ‘ LED ë„ê¸°</option>
              <option value="servo">ğŸšª ì„œë³´ëª¨í„° ë‹«ê¸°</option>
              <option value="speaker">ğŸ”‡ ì†Œë¦¬ ë„ê¸°</option>
              <option value="motor">ğŸ›‘ ëª¨í„° ë„ê¸°</option>
            </select>
            <input type="text" id="inp-act-off" class="input-line" placeholder="ìƒì„¸ ë™ì‘ (ì˜ˆ: 0ë„ ë³µê·€)">
          </div>
        </div>
        <br>
        <div class="form-group">
          <label class="label">ğŸ“ ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ ì •ë¦¬</label>
          <textarea id="inp-scenario" class="text-area" placeholder="ì‘ë™ ê³¼ì •ì„ ëˆ„êµ¬ë‚˜ ì´í•´í•  ìˆ˜ ìˆê²Œ í•œ ë¬¸ë‹¨ìœ¼ë¡œ ì •ë¦¬í•´ì£¼ì„¸ìš”."></textarea>
        </div>
      </div>

        <!-- ì œì¶œ ì„¹ì…˜ -->
        <div class="design-section" style="margin-bottom: 20px;">
        <div class="step-header">
          <div class="step-title">4. AI ê²€ì‚¬ ë° ìµœì¢… ì œì¶œ</div>
          <div class="step-desc">ë‚´ìš©ì„ ì ê²€í•˜ê³  ì„ ìƒë‹˜ê»˜ ì œì¶œí•©ë‹ˆë‹¤.</div>
        </div>

          <div class="sensor-tip" style="background:rgba(254, 243, 199, 0.6); border-color:#f59e0b; color:#92400e;">
          <strong>ğŸš¨ ì œì¶œ ì „ í•„ìˆ˜ ì²´í¬!</strong><br>
            1. ë¨¼ì € 'ê²€ì‚¬' ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”.<br>
            2. ì˜ˆì‹œë¥¼ ê·¸ëŒ€ë¡œ ë² ë¼ë©´ <strong>í‘œì ˆ</strong>ë¡œ ì²˜ë¦¬ë˜ì–´ ì œì¶œ ë¶ˆê°€í•©ë‹ˆë‹¤.<br>
            3. ë‚´ìš©ì´ ë„ˆë¬´ ì§§ê±°ë‚˜ ë¶€ì‹¤í•˜ë©´ <strong>ê²€ì‚¬ì—ì„œ ë°˜ë ¤</strong>ë©ë‹ˆë‹¤.<br>
            4. ê²€ì‚¬ í†µê³¼ í›„ 'ì œì¶œ' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì œì¶œí•˜ê³ , <strong>ì„ ìƒë‹˜ì˜ ìŠ¹ì¸</strong>ì„ ë°›ì•„ì•¼ ì™„ë£Œë©ë‹ˆë‹¤.
        </div>

        <div class="chat-box" id="chat-box">
            <div class="chat-bubble chat-ai">ì•ˆë…•! ë‚˜ëŠ” ë„ˆì˜ ì„¤ê³„ë¥¼ ë„ì™€ì¤„ AI ì½”ì¹˜ì•¼. ë¨¼ì € 'ê²€ì‚¬' ë²„íŠ¼ìœ¼ë¡œ ë‚´ìš©ì„ í™•ì¸í•œ í›„, ë¬¸ì œê°€ ì—†ìœ¼ë©´ 'ì œì¶œ' ë²„íŠ¼ì„ ëˆŒëŸ¬ì¤˜. ğŸ¤–</div>
        </div>
      </div>
      </div>
    </div>

    <div class="bottom-nav">
      <button class="nav-btn btn-check" id="btn-check" onclick="checkAssignment()">ğŸ” ê²€ì‚¬</button>
      <button class="nav-btn btn-submit" id="btn-submit" onclick="submitAssignment()" style="opacity:0.5; cursor:not-allowed;" disabled>âœ… ì œì¶œ</button>
    </div>
  </div>
</div>

<script type="module" src="/env-config.js"></script>
<script>
  /* =========================================
     GLOBAL VARIABLES
     ========================================= */
  let currentUser = { id: '', name: '' };
  let lastLoadedExample = null; // í‘œì ˆ ê²€ì‚¬ìš©
  let isChecked = false; // ê²€ì‚¬ í†µê³¼ ì—¬ë¶€
  const TEACHER_PW = "1234"; // êµì‚¬ ë¹„ë°€ë²ˆí˜¸

  /* =========================================
     API í‚¤ ê°€ì ¸ì˜¤ê¸° (localStorage â†’ í™˜ê²½ ë³€ìˆ˜ ìˆœì„œ)
     ========================================= */
  function getApiKey() {
    // 1. localStorageì—ì„œ ë¨¼ì € í™•ì¸ (êµì‚¬ê°€ ì„¤ì •í•œ ê°’ ìš°ì„ )
    const storedKey = localStorage.getItem('openai_api_key');
    if(storedKey) return storedKey;
    
    // 2. í™˜ê²½ ë³€ìˆ˜ì—ì„œ í™•ì¸ (Vite í™˜ê²½ ë³€ìˆ˜)
    if(typeof window !== 'undefined' && window.VITE_OPENAI_API_KEY) {
      // í™˜ê²½ ë³€ìˆ˜ ê°’ì„ localStorageì— ì €ì¥ (ë‹¤ìŒì— ë¹ ë¥´ê²Œ ì ‘ê·¼)
      localStorage.setItem('openai_api_key', window.VITE_OPENAI_API_KEY);
      return window.VITE_OPENAI_API_KEY;
    }
    
    return null;
  }

  /* =========================================
     VIEW NAVIGATION
     ========================================= */
  function showView(viewId) {
    document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
    document.getElementById(viewId).classList.add('active');
    
    // ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°” í‘œì‹œ/ìˆ¨ê¹€ ì œì–´
    const topNav = document.getElementById('top-nav');
    if(viewId === 'view-intro') {
      topNav.classList.add('hidden');
      document.body.style.paddingTop = '20px';
    } else {
      topNav.classList.remove('hidden');
      document.body.style.paddingTop = '60px';
    }
    
    // í•™ìŠµ í˜ì´ì§€ë¡œ ì´ë™ ì‹œ ì‹œë®¬ë ˆì´ì…˜ ì´ˆê¸°í™” ë° í€´ì¦ˆ ìƒíƒœ ì´ˆê¸°í™”
    if(viewId === 'view-student-learning') {
      setTimeout(() => {
        initSimulation();
        quizAnswered = false; // í€´ì¦ˆ ìƒíƒœ ì´ˆê¸°í™”
        const feedback = document.getElementById('quiz-feedback');
        if(feedback) {
          feedback.style.display = 'none';
        }
        // ë°°ìš´ ì  ì •ë¦¬ í”¼ë“œë°± ì´ˆê¸°í™”
        const reflectionFeedback = document.getElementById('reflection-feedback');
        if(reflectionFeedback) {
          reflectionFeedback.style.display = 'none';
        }
        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ˆê¸°í™”
        setTimeout(() => {
          resetDragDrop();
          initDragDrop();
        }, 100);
        // ëª¨ë“  í€´ì¦ˆ ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
        document.querySelectorAll('.quiz-option-btn').forEach(btn => {
          btn.classList.remove('correct', 'wrong');
        });
        
        // í•™ìŠµ ì™„ë£Œ ì—¬ë¶€ í™•ì¸í•˜ì—¬ ë°°ì§€ í‘œì‹œ
        if(currentUser && currentUser.id && currentUser.name) {
          const completed = checkLearningCompleted(currentUser.id, currentUser.name);
          const badge = document.getElementById('learning-completed-badge');
          if(badge) {
            badge.style.display = completed ? 'block' : 'none';
          }
        }
      }, 100);
    }
  }

  function showIntro() { showView('view-intro'); }
  function goToStudentLogin() { showView('view-student-login'); }
  function goToTeacherLogin() { 
    document.getElementById('tea-pw').value = ''; 
    showView('view-teacher-login'); 
  }

  /* =========================================
     STUDENT LOGIC
     ========================================= */
  function studentLogin() {
    const id = document.getElementById('std-id').value.trim();
    const name = document.getElementById('std-name').value.trim();
    if(!id || !name) { alert('í•™ë²ˆê³¼ ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

    currentUser = { id, name };
    document.getElementById('user-display').textContent = `${id} ${name}`;
    document.getElementById('learning-user-display').textContent = `${id} ${name}`;
    
    // í•™ë²ˆ ê¸°ë°˜ìœ¼ë¡œ ìë™ìœ¼ë¡œ í•™ê¸‰ì— ë°°ì •
    assignStudentToClassById(id, name);
    
    // í•™ìŠµ ì™„ë£Œ ì—¬ë¶€ í™•ì¸
    const learningCompleted = checkLearningCompleted(id, name);
    
    // í”¼ë“œë°± ì•Œë¦¼ í™•ì¸
    checkFeedbackNotification(id, name);
    
    if(learningCompleted) {
      // ì´ë¯¸ í•™ìŠµì„ ì™„ë£Œí–ˆë‹¤ë©´ ë°”ë¡œ ì•„ì´ë””ì–´ ì„¤ê³„ í˜ì´ì§€ë¡œ ì´ë™
      loadMySubmission();
      showView('view-student-main');
    } else {
      // í•™ìŠµì„ ì™„ë£Œí•˜ì§€ ì•Šì•˜ë‹¤ë©´ í•™ìŠµ í˜ì´ì§€ë¡œ ì´ë™
      showView('view-student-learning');
      initSimulation();
    }
  }
  
  function checkLearningCompleted(id, name) {
    // localStorageì—ì„œ í•™ìŠµ ì™„ë£Œ ìƒíƒœ í™•ì¸
    const completedKey = `learning_completed_${id}_${name}`;
    return localStorage.getItem(completedKey) === 'true';
  }
  
  function setLearningCompleted(id, name) {
    // localStorageì— í•™ìŠµ ì™„ë£Œ ìƒíƒœ ì €ì¥
    const completedKey = `learning_completed_${id}_${name}`;
    localStorage.setItem(completedKey, 'true');
  }
  
  // ì•„ì´ë””ì–´ ì„¤ê³„ í˜ì´ì§€ë¡œ ì´ë™
  function goToDesignPage() {
    if(currentUser && currentUser.id && currentUser.name) {
      loadMySubmission();
      showView('view-student-main');
    } else {
      alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
      showView('view-student-login');
    }
  }
  
  // í”¼ë“œë°± ì•Œë¦¼ í™•ì¸ ë° í‘œì‹œ
  function checkFeedbackNotification(id, name) {
    const allSubmissions = JSON.parse(localStorage.getItem('student_submissions') || '[]');
    const mySub = allSubmissions.find(s => s.id === id && s.name === name);
    
    if(!mySub) return;
    
    // í”¼ë“œë°±ì´ ìˆê³  ì•„ì§ í™•ì¸í•˜ì§€ ì•Šì€ ê²½ìš°
    const notificationKey = `feedback_notified_${id}_${name}_${mySub.timestamp}`;
    const alreadyNotified = localStorage.getItem(notificationKey) === 'true';
    
    if((mySub.status === 'rejected' || mySub.status === 'approved') && mySub.teacherFeedback && !alreadyNotified) {
      // ì•Œë¦¼ í‘œì‹œ
      showFeedbackNotification(mySub);
      // ì•Œë¦¼ í™•ì¸ í”Œë˜ê·¸ ì €ì¥
      localStorage.setItem(notificationKey, 'true');
    }
  }
  
  // í”¼ë“œë°± ì•Œë¦¼ ëª¨ë‹¬ í‘œì‹œ
  function showFeedbackNotification(submission) {
    const isRejected = submission.status === 'rejected';
    const modal = document.createElement('div');
    modal.id = 'feedback-notification-modal';
    modal.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      animation: fadeIn 0.3s;
    `;
    
    modal.innerHTML = `
      <div style="
        background: white;
        border-radius: 20px;
        padding: 30px;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: popIn 0.3s;
      ">
        <div style="text-align: center; margin-bottom: 20px;">
          <div style="font-size: 48px; margin-bottom: 10px;">
            ${isRejected ? 'âš ï¸' : 'ğŸ‰'}
          </div>
          <h2 style="font-size: 24px; font-weight: 800; color: #1e293b; margin-bottom: 10px;">
            ${isRejected ? 'í”¼ë“œë°±ì„ ë°›ì•˜ìŠµë‹ˆë‹¤' : 'ê³¼ì œê°€ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤!'}
          </h2>
          <p style="font-size: 14px; color: #64748b;">
            ${isRejected ? 'ì„ ìƒë‹˜ê»˜ì„œ í”¼ë“œë°±ì„ ë‚¨ê²¨ì£¼ì…¨ìŠµë‹ˆë‹¤. í™•ì¸ í›„ ìˆ˜ì •í•˜ì—¬ ì¬ì œì¶œí•´ì£¼ì„¸ìš”.' : 'ì¶•í•˜í•©ë‹ˆë‹¤! ì„ ìƒë‹˜ê»˜ì„œ ê³¼ì œë¥¼ ìŠ¹ì¸í•˜ì…¨ìŠµë‹ˆë‹¤.'}
          </p>
        </div>
        
        <div style="
          background: ${isRejected ? 'rgba(254, 242, 242, 0.5)' : 'rgba(237, 233, 254, 0.5)'};
          border: 2px solid ${isRejected ? '#ef4444' : '#8b5cf6'};
          border-radius: 12px;
          padding: 20px;
          margin-bottom: 20px;
          max-height: 300px;
          overflow-y: auto;
        ">
          <div style="font-size: 13px; font-weight: 700; color: ${isRejected ? '#991b1b' : '#6d28d9'}; margin-bottom: 10px;">
            ğŸ“ ì„ ìƒë‹˜ í”¼ë“œë°±:
          </div>
          <div style="font-size: 14px; color: #475569; line-height: 1.6; white-space: pre-wrap;">
            ${submission.teacherFeedback || 'í”¼ë“œë°±ì´ ì—†ìŠµë‹ˆë‹¤.'}
          </div>
        </div>
        
        <div style="display: flex; gap: 10px;">
          <button onclick="closeFeedbackNotification()" style="
            flex: 1;
            padding: 12px;
            background: #f1f5f9;
            color: #475569;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
          ">ë‚˜ì¤‘ì— ë³´ê¸°</button>
          <button onclick="goToDesignPageFromNotification()" style="
            flex: 1;
            padding: 12px;
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(139, 92, 246, 0.3);
            transition: all 0.2s;
          ">${isRejected ? 'ìˆ˜ì •í•˜ëŸ¬ ê°€ê¸°' : 'í™•ì¸í•˜ê¸°'}</button>
        </div>
      </div>
    `;
    
    document.body.appendChild(modal);
    
    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    modal.addEventListener('click', function(e) {
      if(e.target === modal) {
        closeFeedbackNotification();
      }
    });
  }
  
  function closeFeedbackNotification() {
    const modal = document.getElementById('feedback-notification-modal');
    if(modal) {
      modal.remove();
    }
  }
  
  function goToDesignPageFromNotification() {
    closeFeedbackNotification();
    goToDesignPage();
  }
  
  // ì¬ì œì¶œ ì•ˆë‚´ ì¹´ë“œ í‘œì‹œ
  function showResubmissionGuide(feedback) {
    // ê¸°ì¡´ ì•ˆë‚´ ì¹´ë“œê°€ ìˆìœ¼ë©´ ì œê±°
    const existingGuide = document.getElementById('resubmission-guide');
    if(existingGuide) {
      existingGuide.remove();
    }
    
    const designContainer = document.getElementById('design-form-container');
    if(!designContainer) return;
    
    const guide = document.createElement('div');
    guide.id = 'resubmission-guide';
    guide.style.cssText = `
      background: linear-gradient(135deg, #fef2f2, #fee2e2);
      border: 2px solid #ef4444;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 30px;
      animation: popIn 0.3s;
    `;
    
    guide.innerHTML = `
      <div style="display: flex; align-items: flex-start; gap: 15px;">
        <div style="font-size: 32px;">âš ï¸</div>
        <div style="flex: 1;">
          <h3 style="font-size: 18px; font-weight: 800; color: #991b1b; margin-bottom: 10px;">
            í”¼ë“œë°±ì„ ë°›ì•˜ìŠµë‹ˆë‹¤ - ìˆ˜ì • í›„ ì¬ì œì¶œí•´ì£¼ì„¸ìš”
          </h3>
          <div style="
            background: white;
            border: 1px solid #fecaca;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            max-height: 200px;
            overflow-y: auto;
          ">
            <div style="font-size: 13px; font-weight: 700; color: #991b1b; margin-bottom: 8px;">
              ğŸ“ ì„ ìƒë‹˜ í”¼ë“œë°±:
            </div>
            <div style="font-size: 14px; color: #475569; line-height: 1.6; white-space: pre-wrap;">
              ${feedback || 'í”¼ë“œë°±ì´ ì—†ìŠµë‹ˆë‹¤.'}
            </div>
          </div>
          <div style="
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid #ef4444;
            padding: 12px;
            border-radius: 6px;
            font-size: 13px;
            color: #991b1b;
            line-height: 1.5;
          ">
            ğŸ’¡ <strong>ì•ˆë‚´:</strong> ìœ„ í”¼ë“œë°±ì„ ì°¸ê³ í•˜ì—¬ ë‚´ìš©ì„ ìˆ˜ì •í•œ í›„, ë‹¤ì‹œ "ê²€ì‚¬" ë²„íŠ¼ì„ ëˆŒëŸ¬ ê²€ì¦í•˜ê³  "ì œì¶œ" ë²„íŠ¼ìœ¼ë¡œ ì¬ì œì¶œí•´ì£¼ì„¸ìš”.
          </div>
        </div>
      </div>
    `;
    
    // ì„¤ê³„ í¼ ì»¨í…Œì´ë„ˆì˜ ë§¨ ìœ„ì— ì‚½ì…
    designContainer.insertBefore(guide, designContainer.firstChild);
  }
  
  // í”¼ë“œë°± ì•Œë¦¼ í™•ì¸ ë° í‘œì‹œ
  function checkFeedbackNotification(id, name) {
    const allSubmissions = JSON.parse(localStorage.getItem('student_submissions') || '[]');
    const mySub = allSubmissions.find(s => s.id === id && s.name === name);
    
    if(!mySub) return;
    
    // í”¼ë“œë°±ì´ ìˆê³  ì•„ì§ í™•ì¸í•˜ì§€ ì•Šì€ ê²½ìš°
    const notificationKey = `feedback_notified_${id}_${name}_${mySub.timestamp}`;
    const alreadyNotified = localStorage.getItem(notificationKey) === 'true';
    
    if((mySub.status === 'rejected' || mySub.status === 'approved') && mySub.teacherFeedback && !alreadyNotified) {
      // ì•Œë¦¼ í‘œì‹œ
      showFeedbackNotification(mySub);
      // ì•Œë¦¼ í™•ì¸ í”Œë˜ê·¸ ì €ì¥
      localStorage.setItem(notificationKey, 'true');
    }
  }
  
  // í”¼ë“œë°± ì•Œë¦¼ ëª¨ë‹¬ í‘œì‹œ
  function showFeedbackNotification(submission) {
    const isRejected = submission.status === 'rejected';
    const modal = document.createElement('div');
    modal.id = 'feedback-notification-modal';
    modal.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      animation: fadeIn 0.3s;
    `;
    
    modal.innerHTML = `
      <div style="
        background: white;
        border-radius: 20px;
        padding: 30px;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: popIn 0.3s;
      ">
        <div style="text-align: center; margin-bottom: 20px;">
          <div style="font-size: 48px; margin-bottom: 10px;">
            ${isRejected ? 'âš ï¸' : 'ğŸ‰'}
          </div>
          <h2 style="font-size: 24px; font-weight: 800; color: #1e293b; margin-bottom: 10px;">
            ${isRejected ? 'í”¼ë“œë°±ì„ ë°›ì•˜ìŠµë‹ˆë‹¤' : 'ê³¼ì œê°€ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤!'}
          </h2>
          <p style="font-size: 14px; color: #64748b;">
            ${isRejected ? 'ì„ ìƒë‹˜ê»˜ì„œ í”¼ë“œë°±ì„ ë‚¨ê²¨ì£¼ì…¨ìŠµë‹ˆë‹¤. í™•ì¸ í›„ ìˆ˜ì •í•˜ì—¬ ì¬ì œì¶œí•´ì£¼ì„¸ìš”.' : 'ì¶•í•˜í•©ë‹ˆë‹¤! ì„ ìƒë‹˜ê»˜ì„œ ê³¼ì œë¥¼ ìŠ¹ì¸í•˜ì…¨ìŠµë‹ˆë‹¤.'}
          </p>
        </div>
        
        <div style="
          background: ${isRejected ? 'rgba(254, 242, 242, 0.5)' : 'rgba(237, 233, 254, 0.5)'};
          border: 2px solid ${isRejected ? '#ef4444' : '#8b5cf6'};
          border-radius: 12px;
          padding: 20px;
          margin-bottom: 20px;
          max-height: 300px;
          overflow-y: auto;
        ">
          <div style="font-size: 13px; font-weight: 700; color: ${isRejected ? '#991b1b' : '#6d28d9'}; margin-bottom: 10px;">
            ğŸ“ ì„ ìƒë‹˜ í”¼ë“œë°±:
          </div>
          <div style="font-size: 14px; color: #475569; line-height: 1.6; white-space: pre-wrap;">
            ${submission.teacherFeedback || 'í”¼ë“œë°±ì´ ì—†ìŠµë‹ˆë‹¤.'}
          </div>
        </div>
        
        <div style="display: flex; gap: 10px;">
          <button onclick="closeFeedbackNotification()" style="
            flex: 1;
            padding: 12px;
            background: #f1f5f9;
            color: #475569;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
          ">ë‚˜ì¤‘ì— ë³´ê¸°</button>
          <button onclick="goToDesignPageFromNotification()" style="
            flex: 1;
            padding: 12px;
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(139, 92, 246, 0.3);
            transition: all 0.2s;
          ">${isRejected ? 'ìˆ˜ì •í•˜ëŸ¬ ê°€ê¸°' : 'í™•ì¸í•˜ê¸°'}</button>
        </div>
      </div>
    `;
    
    document.body.appendChild(modal);
    
    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    modal.addEventListener('click', function(e) {
      if(e.target === modal) {
        closeFeedbackNotification();
      }
    });
  }
  
  function closeFeedbackNotification() {
    const modal = document.getElementById('feedback-notification-modal');
    if(modal) {
      modal.remove();
    }
  }
  
  function goToDesignPageFromNotification() {
    closeFeedbackNotification();
    goToDesignPage();
  }

  // ìŠ¤í… ì „í™˜ í•¨ìˆ˜ ì œê±° (í•œ í˜ì´ì§€ë¡œ í†µí•©ë¨)

  // ì˜ˆì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
  function loadExample() {
    const ex = {
      problem: "í•™êµ í™”ì¥ì‹¤ì—ì„œ ë¬¼ì„ ì‚¬ìš©í•œ í›„ ìˆ˜ë„ê¼­ì§€ë¥¼ ì™„ì „íˆ ì ê·¸ì§€ ì•Šì•„ ë¬¼ì´ ê³„ì† ìƒˆì–´ë‚˜ê°€ê³ , íŠ¹íˆ ì–´ë¦° í•™ìƒë“¤ì´ ìì£¼ ê¹œë¹¡ ìŠì–´ë²„ë ¤ ë¬¼ ë‚­ë¹„ê°€ ì‹¬ê°í•©ë‹ˆë‹¤. ë˜í•œ ì‚¬ìš© ì¤‘ì¸ì§€ ì—¬ë¶€ë¥¼ ë‹¤ë¥¸ ì‚¬ëŒì´ ì•Œ ìˆ˜ ì—†ì–´ ë¶ˆí¸í•˜ê¸°ë„ í•©ë‹ˆë‹¤.",
      sdg: "6",
      dist: "30",
      cond_on: "ì´ˆìŒíŒŒ ì„¼ì„œê°€ 30cm ì´ë‚´ì˜ ë¬¼ì²´(ì‚¬ëŒ)ë¥¼ ê°ì§€í•˜ë©´",
      cond_off: "ë¬¼ì²´ê°€ 30cm ì´ìƒ ë©€ì–´ì§€ê±°ë‚˜ 5ë¶„ ì´ìƒ ê°™ì€ ìœ„ì¹˜ì— ì—†ìœ¼ë©´",
      dev_on: "servo", act_on: "ì„œë³´ëª¨í„°ë¡œ ìˆ˜ë„ê¼­ì§€ë¥¼ ìë™ìœ¼ë¡œ ì ê·¸ê³ , LEDë¡œ 'ì‚¬ìš© ì¤‘' í‘œì‹œ",
      dev_off: "servo", act_off: "ì„œë³´ëª¨í„°ë¡œ ìˆ˜ë„ê¼­ì§€ë¥¼ ë‹¤ì‹œ ì—´ê³ , LED ë„ê¸°",
      scenario: "í™”ì¥ì‹¤ ì…êµ¬ì— ì´ˆìŒíŒŒ ì„¼ì„œë¥¼ ì„¤ì¹˜í•˜ê³ , ì‚¬ëŒì´ 30cm ì•ˆìœ¼ë¡œ ë“¤ì–´ì˜¤ë©´ ì„œë³´ëª¨í„°ê°€ ìˆ˜ë„ê¼­ì§€ë¥¼ ìë™ìœ¼ë¡œ ì—´ê³  'ì‚¬ìš© ì¤‘' LEDë¥¼ ì¼­ë‹ˆë‹¤. ì‚¬ìš©ìê°€ 30cm ì´ìƒ ë©€ì–´ì§€ê±°ë‚˜ 5ë¶„ ì´ìƒ ì›€ì§ì„ì´ ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ ìˆ˜ë„ê¼­ì§€ë¥¼ ì ê°€ ë¬¼ ë‚­ë¹„ë¥¼ ë°©ì§€í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ Goal 6 'ê¹¨ë—í•œ ë¬¼ê³¼ ìœ„ìƒ' ë‹¬ì„±ì— ê¸°ì—¬í•©ë‹ˆë‹¤."
    };

    document.getElementById('inp-problem').value = ex.problem;
    document.getElementById('inp-sdg').value = ex.sdg;
    document.getElementById('inp-dist').value = ex.dist;
    document.getElementById('inp-cond-on').value = ex.cond_on;
    document.getElementById('inp-cond-off').value = ex.cond_off;
    document.getElementById('inp-dev-on').value = ex.dev_on;
    document.getElementById('inp-act-on').value = ex.act_on;
    document.getElementById('inp-dev-off').value = ex.dev_off;
    document.getElementById('inp-act-off').value = ex.act_off;
    document.getElementById('inp-scenario').value = ex.scenario;

    lastLoadedExample = ex; // í‘œì ˆ ê²€ì‚¬ìš© ì €ì¥
    alert("ì˜ˆì‹œë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. ë‚´ìš©ì„ ë°˜ë“œì‹œ ìˆ˜ì •í•´ì„œ ì œì¶œí•˜ì„¸ìš”!");
  }

  // í‘œì ˆ ê²€ì‚¬
  function checkPlagiarism() {
    if(!lastLoadedExample) return false;
    const currProb = document.getElementById('inp-problem').value.trim();
    const currScen = document.getElementById('inp-scenario').value.trim();
    return (currProb === lastLoadedExample.problem || currScen === lastLoadedExample.scenario);
  }

  // ì±„íŒ… ë©”ì‹œì§€ ì¶”ê°€
  function addChat(msg, type='ai') {
    const box = document.getElementById('chat-box');
    box.style.display = 'flex';
    const bubble = document.createElement('div');
    bubble.className = `chat-bubble chat-${type}`;
    bubble.innerHTML = msg;
    box.appendChild(bubble);
    box.scrollTop = box.scrollHeight;
  }

  // ìƒì„¸ ê²€ì‚¬ ë° í”¼ë“œë°± ì œê³µ
  function checkAssignment() {
    const box = document.getElementById('chat-box');
    box.style.display = 'flex';
    box.innerHTML = ''; // ì´ˆê¸°í™”
    
    addChat("ğŸ“„ ë‚´ìš©ì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...", "ai");

    setTimeout(async () => {
      isChecked = false; // ì´ˆê¸°í™”
      
      // 1. í‘œì ˆ ê²€ì‚¬
      if(checkPlagiarism()) {
        addChat("ğŸš¨ <strong>[ê²€ì‚¬ ì‹¤íŒ¨] í‘œì ˆì´ ì˜ì‹¬ë©ë‹ˆë‹¤.</strong><br>ì˜ˆì‹œ ë‚´ìš©ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ì§€ ë§ê³ , ë³¸ì¸ì˜ ìƒê°ìœ¼ë¡œ ìˆ˜ì •í•´ì£¼ì„¸ìš”.", "warn");
        addChat("ë‚´ìš©ì„ ìˆ˜ì •í•œ í›„ ë‹¤ì‹œ ê²€ì‚¬í•´ì£¼ì„¸ìš”.", "warn");
        disableSubmitButton();
        return;
      }

      // 2. ê¸°ë³¸ ê²€ì¦
      const prob = document.getElementById('inp-problem').value.trim();
      const scen = document.getElementById('inp-scenario').value.trim();
      const sdg = document.getElementById('inp-sdg').value;
      const dist = document.getElementById('inp-dist').value.trim();
      const condOn = document.getElementById('inp-cond-on').value.trim();
      const condOff = document.getElementById('inp-cond-off').value.trim();
      const devOn = document.getElementById('inp-dev-on').value;
      const actOn = document.getElementById('inp-act-on').value.trim();
      const devOff = document.getElementById('inp-dev-off').value;
      const actOff = document.getElementById('inp-act-off').value.trim();

      let warnings = [];
      let suggestions = [];
      
      // ë¬¸ì œ ì •ì˜ ê²€ì¦
      if(prob.length < 30) {
        warnings.push("ë¬¸ì œ ì •ì˜ê°€ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤. êµ¬ì²´ì ì¸ ìƒí™©ê³¼ ë¬¸ì œì ì„ ë” ìì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”.");
      }
      if(!prob.includes('ë¬¸ì œ') && !prob.includes('ë¶ˆí¸') && !prob.includes('ë‚­ë¹„') && !prob.includes('ìœ„í—˜')) {
        suggestions.push("ë¬¸ì œ ìƒí™©ì„ ë” ëª…í™•í•˜ê²Œ ë“œëŸ¬ë‚´ëŠ” í‘œí˜„ì„ ì‚¬ìš©í•´ë³´ì„¸ìš” (ì˜ˆ: 'ë¬¸ì œ', 'ë¶ˆí¸', 'ë‚­ë¹„', 'ìœ„í—˜' ë“±).");
      }
      
      // SDG ê´€ë ¨ì„± ê²€ì¦
      if(!sdg) {
        warnings.push("SDGs ëª©í‘œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”. í•´ê²°í•˜ê³ ì í•˜ëŠ” ë¬¸ì œì™€ ê°€ì¥ ê´€ë ¨ì´ ê¹Šì€ ëª©í‘œë¥¼ ì„ íƒí•˜ì„¸ìš”.");
      }
      
      // ê±°ë¦¬ ê¸°ì¤€ ê²€ì¦
      if(!dist || isNaN(dist) || dist < 5 || dist > 500) {
        warnings.push("ê±°ë¦¬ ê¸°ì¤€ì„ 5cm~500cm ì‚¬ì´ì˜ í•©ë¦¬ì ì¸ ê°’ìœ¼ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”.");
      } else {
        const distNum = parseInt(dist);
        if(distNum < 10) {
          suggestions.push("ê±°ë¦¬ ê¸°ì¤€ì´ ë„ˆë¬´ ì‘ìŠµë‹ˆë‹¤. 10cm ì´ìƒì´ë©´ ë” ì•ˆì •ì ìœ¼ë¡œ ì‘ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
        } else if(distNum > 200) {
          suggestions.push("ê±°ë¦¬ ê¸°ì¤€ì´ ë„ˆë¬´ í½ë‹ˆë‹¤. ì‹¤ì œ í™˜ê²½ì„ ê³ ë ¤í•˜ì—¬ ì¡°ì •í•´ë³´ì„¸ìš”.");
        }
      }
      
      // ì¡°ê±´ ëª…í™•ì„± ê²€ì¦
      if(condOn.length < 10 || condOff.length < 10) {
        warnings.push("ì„¼ì„œ ê°ì§€ ì¡°ê±´ì„ ë” êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•´ì£¼ì„¸ìš”. (ì˜ˆ: '30cm ì•ˆìœ¼ë¡œ ë“¤ì–´ì˜¤ë©´', '30cm ì´ìƒ ë©€ì–´ì§€ë©´')");
      }
      if(!condOn.includes(dist) || !condOff.includes(dist)) {
        suggestions.push("ê°ì§€ ì¡°ê±´ì— ì„¤ì •í•œ ê±°ë¦¬ ê¸°ì¤€(" + dist + "cm)ì„ ëª…í™•íˆ í¬í•¨í•´ì£¼ì„¸ìš”.");
      }
      
      // ì¥ì¹˜ ì¼ê´€ì„± ê²€ì¦
      if(devOn !== devOff) {
        warnings.push("ON/OFF ì¥ì¹˜ê°€ ë‹¤ë¦…ë‹ˆë‹¤. ê°™ì€ ì¥ì¹˜ë¥¼ ì œì–´í•´ì•¼ í•©ë‹ˆë‹¤ (ì˜ˆ: LED ì¼œê¸°/ë„ê¸°).");
      }
      
      // ë™ì‘ êµ¬ì²´ì„± ê²€ì¦
      if(actOn.length < 5 || actOff.length < 5) {
        warnings.push("ì¥ì¹˜ ë™ì‘ì„ ë” êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•´ì£¼ì„¸ìš”. (ì˜ˆ: 'ì¡°ëª… ì¼œê¸°', '90ë„ íšŒì „')");
      }
      
      // ì‹œë‚˜ë¦¬ì˜¤ ì¶©ì‹¤ë„
      if(scen.length < 50) {
        warnings.push("ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë” êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”. (ìµœì†Œ 50ì ì´ìƒ ê¶Œì¥)");
      }
      if(!scen.includes(prob.substring(0, 10))) {
        suggestions.push("ì‹œë‚˜ë¦¬ì˜¤ì— ì œì‹œí•œ ë¬¸ì œì™€ì˜ ì—°ê²°ê³ ë¦¬ë¥¼ ë” ëª…í™•íˆ í•´ì£¼ì„¸ìš”.");
      }
      
      // SDGs ê´€ë ¨ì„± í™•ì¸
      if(sdg && scen.length > 0) {
        const sdgNames = {
          '3': 'ê±´ê°•', '4': 'êµìœ¡', '6': 'ë¬¼', '7': 'ì—ë„ˆì§€',
          '11': 'ë„ì‹œ', '12': 'ì†Œë¹„', '13': 'ê¸°í›„', '14': 'í•´ì–‘', '15': 'ìœ¡ìƒ'
        };
        const sdgName = sdgNames[sdg];
        if(sdgName && !scen.includes(sdgName) && !scen.includes('SDG') && !scen.includes('ëª©í‘œ')) {
          suggestions.push("ì‹œë‚˜ë¦¬ì˜¤ì— ì„ íƒí•œ SDGs ëª©í‘œ(" + sdgNames[sdg] + ")ì™€ì˜ ì—°ê´€ì„±ì„ ë” ëª…í™•íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”.");
        }
      }

      // ì‹¤í˜„ ê°€ëŠ¥ì„± ì²´í¬
      if(condOn.includes('ì‚¬ëŒ') || condOn.includes('ê°•ì•„ì§€') || condOn.includes('ê³ ì–‘ì´')) {
        suggestions.push("ğŸ’¡ ì´ˆìŒíŒŒ ì„¼ì„œëŠ” ë¬¼ì²´ ì¢…ë¥˜ë¥¼ êµ¬ë³„í•˜ì§€ ëª»í•©ë‹ˆë‹¤. 'ë¬¼ì²´', 'ì¥ì• ë¬¼' ë“±ìœ¼ë¡œ í‘œí˜„í•˜ëŠ” ê²ƒì´ ë” ì •í™•í•©ë‹ˆë‹¤.");
      }
      
      if(condOn.includes('ì†Œë¦¬') || condOn.includes('ëƒ„ìƒˆ') || condOn.includes('ë¹›')) {
        warnings.push("âš ï¸ ì´ˆìŒíŒŒ ì„¼ì„œëŠ” ê±°ë¦¬ë§Œ ì¸¡ì • ê°€ëŠ¥í•©ë‹ˆë‹¤. ì†Œë¦¬, ëƒ„ìƒˆ, ë¹› ë“±ì€ ê°ì§€í•˜ì§€ ëª»í•©ë‹ˆë‹¤.");
      }

      // í”¼ë“œë°± ì œê³µ
      if(warnings.length > 0) {
        addChat("âš ï¸ <strong>[ê²€ì‚¬ ê²°ê³¼] ìˆ˜ì •ì´ í•„ìš”í•œ ë¶€ë¶„ì´ ìˆìŠµë‹ˆë‹¤.</strong>", "warn");
        warnings.forEach(w => addChat("âŒ " + w, "warn"));
        if(suggestions.length > 0) {
          addChat("<br><strong>ğŸ’¡ ê°œì„  ì œì•ˆ:</strong>", "ai");
          suggestions.forEach(s => addChat("â€¢ " + s, "ai"));
        }
        addChat("<br>ìœ„ ë‚´ìš©ì„ ë³´ì™„í•œ í›„ ë‹¤ì‹œ ê²€ì‚¬í•´ì£¼ì„¸ìš”.", "warn");
        disableSubmitButton();
        return;
      }

      // ì„±ê³µ í”¼ë“œë°± + ì œì•ˆì‚¬í•­
      addChat("âœ… <strong>[ê¸°ë³¸ ê²€ì¦ í†µê³¼]</strong> í•„ìˆ˜ í•­ëª©ì´ ëª¨ë‘ ì¶©ì¡±ë˜ì—ˆìŠµë‹ˆë‹¤!", "success");
      
      if(suggestions.length > 0) {
        addChat("<br><strong>ğŸ’¡ ì¶”ê°€ ê°œì„  ì œì•ˆ:</strong>", "ai");
        suggestions.forEach(s => addChat("â€¢ " + s, "ai"));
        addChat("<br>ìœ„ ì œì•ˆì„ ë°˜ì˜í•˜ë©´ ë” ì™„ì„±ë„ ë†’ì€ ì„¤ê³„ê°€ ë©ë‹ˆë‹¤. (ì„ íƒì‚¬í•­)", "ai");
      }
      
      // SDGs ê´€ë ¨ì„± ê°•ì¡°
      if(sdg) {
        const sdgText = document.getElementById('inp-sdg').options[document.getElementById('inp-sdg').selectedIndex].text;
        addChat("<br>ğŸ¯ <strong>SDGs ê´€ë ¨ì„±:</strong> " + sdgText + " ë‹¬ì„±ì— ê¸°ì—¬í•˜ëŠ” ì¢‹ì€ ì„¤ê³„ì…ë‹ˆë‹¤!", "success");
      }
      
      addChat("<br>ì´ì œ 'ì œì¶œ' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì„ ìƒë‹˜ê»˜ ì œì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.", "success");
      
      isChecked = true;
      enableSubmitButton();

    }, 1500);
  }

  // ì œì¶œ ë¡œì§ (ê²€ì‚¬ í†µê³¼ í›„ì—ë§Œ ì‹¤í–‰)
  function submitAssignment() {
    if(!isChecked) {
      alert("ë¨¼ì € 'ê²€ì‚¬' ë²„íŠ¼ì„ ëˆŒëŸ¬ ê²€ì‚¬ë¥¼ í†µê³¼í•´ì•¼ ì œì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
      return;
    }

    const box = document.getElementById('chat-box');
    box.style.display = 'flex';
    
    addChat("ğŸ“¤ ì œì¶œ ì¤‘ì…ë‹ˆë‹¤...", "ai");

    setTimeout(() => {
      const prob = document.getElementById('inp-problem').value.trim();
      const scen = document.getElementById('inp-scenario').value.trim();

      // ì œì¶œ ë°ì´í„° ì €ì¥
      const submission = {
        id: currentUser.id,
        name: currentUser.name,
        timestamp: new Date().toISOString(),
        problem: prob,
        sdg: document.getElementById('inp-sdg').options[document.getElementById('inp-sdg').selectedIndex].text,
        scenario: scen,
        status: 'pending', // ëŒ€ê¸°ì¤‘
        teacherFeedback: ''
      };

      // ê¸°ì¡´ ë°ì´í„° ë¡œë“œ ë° ê°±ì‹ 
      let allData = JSON.parse(localStorage.getItem('student_submissions') || '[]');
      const idx = allData.findIndex(d => d.id === currentUser.id && d.name === currentUser.name);
      if(idx >= 0) allData[idx] = submission;
      else allData.push(submission);
      
      localStorage.setItem('student_submissions', JSON.stringify(allData));
      
      // í•™ë…„/ë°˜ ì¶”ì¶œí•˜ì—¬ ìë™ìœ¼ë¡œ í•™ê¸‰ì— ë°°ì •
      assignStudentToClassById(currentUser.id, currentUser.name);

      addChat("âœ… <strong>ì œì¶œ ì„±ê³µ!</strong> ì„ ìƒë‹˜ê»˜ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.", "success");
      addChat("ì„ ìƒë‹˜ì˜ ìŠ¹ì¸ì„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.", "success");
      
      loadMySubmission(); // ìƒíƒœ ë°°ë„ˆ ê°±ì‹ 

      // ì œì¶œ ë²„íŠ¼ ë‹¤ì‹œ ë¹„í™œì„±í™”
      isChecked = false;
      disableSubmitButton();

    }, 500);
  }

  // ì œì¶œ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™” í•¨ìˆ˜
  function enableSubmitButton() {
    const btnSubmit = document.getElementById('btn-submit');
    btnSubmit.disabled = false;
    btnSubmit.style.opacity = '1';
    btnSubmit.style.cursor = 'pointer';
  }

  function disableSubmitButton() {
    const btnSubmit = document.getElementById('btn-submit');
    btnSubmit.disabled = true;
    btnSubmit.style.opacity = '0.5';
    btnSubmit.style.cursor = 'not-allowed';
  }

  // ë‚´ ì œì¶œ ìƒíƒœ í™•ì¸ ë° UI ì ê¸ˆ
  function loadMySubmission() {
    const allData = JSON.parse(localStorage.getItem('student_submissions') || '[]');
    const mySub = allData.find(d => d.id === currentUser.id && d.name === currentUser.name);
    
    const banner = document.getElementById('status-banner');
    const statusMsg = document.getElementById('status-msg');
    const statusLabel = document.getElementById('status-label');
    
    // ì´ˆê¸°í™”
    banner.style.display = 'none';
    toggleInputs(true); // ì…ë ¥ ê°€ëŠ¥

    if(mySub) {
      banner.style.display = 'flex';
      banner.className = `status-banner ${mySub.status}`;
      
      // í•„ë“œ ê°’ ë³µêµ¬ (ì¬ë¡œê·¸ì¸ ì‹œ)
      document.getElementById('inp-problem').value = mySub.problem;
      document.getElementById('inp-scenario').value = mySub.scenario;
      // ...ë‚˜ë¨¸ì§€ í•„ë“œëŠ” ìƒëµ

      if(mySub.status === 'pending') {
        statusMsg.innerHTML = "â³ <strong>ì„ ìƒë‹˜ í™•ì¸ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.</strong> (ìˆ˜ì • ë¶ˆê°€)";
        statusLabel.textContent = "ê²€í† ì¤‘";
        toggleInputs(false); // ì ê¸ˆ
      } else if(mySub.status === 'approved') {
        statusMsg.innerHTML = `ğŸ‰ <strong>ê³¼ì œ ìŠ¹ì¸ ì™„ë£Œ!</strong> (í”¼ë“œë°±: ${mySub.teacherFeedback || 'ì—†ìŒ'})`;
        statusLabel.textContent = "ì™„ë£Œ";
        toggleInputs(false); // ì ê¸ˆ
      } else if(mySub.status === 'rejected') {
        statusMsg.innerHTML = `âš ï¸ <strong>ë°˜ë ¤ë˜ì—ˆìŠµë‹ˆë‹¤. ìˆ˜ì • í›„ ì¬ì œì¶œí•˜ì„¸ìš”.</strong> (ì‚¬ìœ : ${mySub.teacherFeedback})`;
        statusLabel.textContent = "ìˆ˜ì •ìš”ë§";
        toggleInputs(true); // ì ê¸ˆ í•´ì œ
        
        // ì¬ì œì¶œ ì•ˆë‚´ ì¹´ë“œ í‘œì‹œ
        showResubmissionGuide(mySub.teacherFeedback);
      }
    }
  }

  function toggleInputs(enable) {
    const inputs = document.querySelectorAll('input, textarea, select, #btn-check, #btn-submit');
    inputs.forEach(el => {
      if(el.id === 'btn-submit' && !enable) {
        // ì…ë ¥ ì ê¸ˆ ì‹œ ì œì¶œ ë²„íŠ¼ë„ ì ê¸ˆ
        el.disabled = true;
        el.style.opacity = '0.5';
        el.style.cursor = 'not-allowed';
      } else {
        el.disabled = !enable;
      }
    });
    if(!enable) {
      isChecked = false; // ì…ë ¥ ì ê¸ˆ ì‹œ ê²€ì‚¬ ìƒíƒœë„ ì´ˆê¸°í™”
    }
  }

  /* =========================================
     TEACHER LOGIC
     ========================================= */
  function teacherLogin() {
    const pw = document.getElementById('tea-pw').value;
    if(pw === TEACHER_PW) {
      showDashboard();
    } else {
      alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
    }
  }

  function showDashboard() {
    showView('view-teacher-dashboard');
    renderTeacherDashboard();
  }
  
  // êµì‚¬ ëŒ€ì‹œë³´ë“œ ë Œë”ë§ (ìƒˆë¡œìš´ êµ¬ì¡°)
  function renderTeacherDashboard() {
    // ëª¨ë“  ì œì¶œëœ í•™ìƒë“¤ì„ í•™ë²ˆ ê¸°ë°˜ìœ¼ë¡œ ìë™ìœ¼ë¡œ í•™ê¸‰ì— ë°°ì •
    organizeStudentsByClass();
    
    // ê¸°ë³¸ì ìœ¼ë¡œ í•™ê¸‰ë³„ ê´€ë¦¬ íƒ­ í‘œì‹œ
    switchTeacherTab('class');
  }
  
  // ëª¨ë“  ì œì¶œëœ í•™ìƒë“¤ì„ í•™ë²ˆ ê¸°ë°˜ìœ¼ë¡œ í•™ê¸‰ë³„ë¡œ ìë™ ì •ë¦¬
  function organizeStudentsByClass() {
    const allSubmissions = JSON.parse(localStorage.getItem('student_submissions') || '[]');
    let classes = JSON.parse(localStorage.getItem('teacher_classes') || '[]');
    
    // ëª¨ë“  í•™ìƒì˜ ì˜¬ë°”ë¥¸ í•™ê¸‰ ì •ë³´ ìˆ˜ì§‘
    const studentClassMap = new Map();
    allSubmissions.forEach(sub => {
      const classInfo = extractGradeAndClass(sub.id);
      if(!classInfo) return; // í•™ë²ˆ í˜•ì‹ì´ ë§ì§€ ì•Šìœ¼ë©´ ê±´ë„ˆëœ€
      
      const studentKey = `${sub.id}|${sub.name}`;
      studentClassMap.set(studentKey, classInfo.className);
    });
    
    // ëª¨ë“  í•™ê¸‰ì—ì„œ í•™ìƒ ì •ë¦¬
    classes = classes.map(classItem => {
      if(!classItem.students) return classItem;
      
      // "ì „ì²´" í•™ê¸‰ì€ ëª¨ë“  í•™ìƒ ìœ ì§€
      if(classItem.id === 'class_all') {
        return classItem;
      }
      
      // ì¼ë°˜ í•™ê¸‰: ì˜¬ë°”ë¥¸ í•™ìƒë§Œ ìœ ì§€
      classItem.students = classItem.students.filter(studentKey => {
        const correctClass = studentClassMap.get(studentKey);
        // í•™ë²ˆ ê¸°ë°˜ìœ¼ë¡œ ì¶”ì¶œí•œ í•™ê¸‰ ì´ë¦„ì´ í˜„ì¬ í•™ê¸‰ ì´ë¦„ê³¼ ì¼ì¹˜í•˜ëŠ” í•™ìƒë§Œ ìœ ì§€
        return correctClass === classItem.name;
      });
      
      return classItem;
    });
    
    // ëª¨ë“  í•™ìƒì„ ì˜¬ë°”ë¥¸ í•™ê¸‰ì— ë°°ì •
    studentClassMap.forEach((correctClassName, studentKey) => {
      // ì˜¬ë°”ë¥¸ í•™ê¸‰ ì°¾ê¸° ë˜ëŠ” ìƒì„±
      let targetClass = classes.find(c => c.name === correctClassName);
      if(!targetClass) {
        const [id, name] = studentKey.split('|');
        const classInfo = extractGradeAndClass(id);
        if(classInfo) {
          targetClass = {
            id: 'class_' + classInfo.grade + '_' + classInfo.classNum,
            name: correctClassName,
            students: []
          };
          classes.push(targetClass);
        }
      }
      
      // í•™ìƒì´ ì˜¬ë°”ë¥¸ í•™ê¸‰ì— ì—†ìœ¼ë©´ ì¶”ê°€
      if(targetClass && !targetClass.students.includes(studentKey)) {
        targetClass.students.push(studentKey);
      }
    });
    
    localStorage.setItem('teacher_classes', JSON.stringify(classes));
  }
  
  // íƒ­ ì „í™˜
  function switchTeacherTab(tabType) {
    const classView = document.getElementById('class-management-view');
    const studentView = document.getElementById('student-management-view');
    const tabs = document.querySelectorAll('.teacher-tab');
    
    tabs.forEach(tab => tab.classList.remove('active'));
    
    if(tabType === 'class') {
      classView.style.display = 'flex';
      studentView.style.display = 'none';
      tabs[0].classList.add('active');
      renderClassManagement();
    } else {
      classView.style.display = 'none';
      studentView.style.display = 'flex';
      tabs[1].classList.add('active');
      renderStudentManagement();
    }
  }
  
  // í•™ê¸‰ë³„ ê´€ë¦¬ ë Œë”ë§
  function renderClassManagement() {
    // ê¸°ë³¸ "ì „ì²´" í•™ê¸‰ì´ ì—†ìœ¼ë©´ ìƒì„±
    ensureDefaultClass();
    renderClassList();
    // ê¸°ë³¸ ì„ íƒëœ í•™ê¸‰ì´ ì—†ìœ¼ë©´ "ì „ì²´" í•™ê¸‰ ì„ íƒ
    const selectedClass = localStorage.getItem('selected_class');
    if(selectedClass) {
      selectClass(selectedClass);
    } else {
      const classes = JSON.parse(localStorage.getItem('teacher_classes') || '[]');
      const defaultClass = classes.find(c => c.id === 'class_all');
      if(defaultClass) {
        selectClass('class_all');
      } else {
        document.getElementById('student-list-container').innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“š</div><div>í•™ê¸‰ì„ ì„ íƒí•˜ì„¸ìš”</div></div>';
        document.getElementById('student-worksheet-container').innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ‘†</div><div>í•™ìƒì„ ì„ íƒí•˜ì„¸ìš”</div></div>';
      }
    }
  }
  
  // ê¸°ë³¸ "ì „ì²´" í•™ê¸‰ ìƒì„±
  function ensureDefaultClass() {
    let classes = JSON.parse(localStorage.getItem('teacher_classes') || '[]');
    const defaultClassExists = classes.find(c => c.id === 'class_all');
    
    if(!defaultClassExists) {
      // ì œì¶œëœ ëª¨ë“  í•™ìƒì„ "ì „ì²´" í•™ê¸‰ì— ì¶”ê°€
      const allSubmissions = JSON.parse(localStorage.getItem('student_submissions') || '[]');
      const allStudents = [...new Set(allSubmissions.map(s => `${s.id}|${s.name}`))];
      
      classes.unshift({
        id: 'class_all',
        name: 'ì „ì²´',
        students: allStudents
      });
      localStorage.setItem('teacher_classes', JSON.stringify(classes));
    } else {
      // ê¸°ì¡´ "ì „ì²´" í•™ê¸‰ì— ìƒˆë¡œ ì œì¶œëœ í•™ìƒ ì¶”ê°€
      const allSubmissions = JSON.parse(localStorage.getItem('student_submissions') || '[]');
      const allStudents = [...new Set(allSubmissions.map(s => `${s.id}|${s.name}`))];
      const existingStudents = new Set(defaultClassExists.students || []);
      
      allStudents.forEach(studentKey => {
        if(!existingStudents.has(studentKey)) {
          defaultClassExists.students.push(studentKey);
        }
      });
      
      classes = classes.map(c => c.id === 'class_all' ? defaultClassExists : c);
      localStorage.setItem('teacher_classes', JSON.stringify(classes));
    }
  }
  
  // í•™ê¸‰ ëª©ë¡ ë Œë”ë§
  function renderClassList() {
    let classes = JSON.parse(localStorage.getItem('teacher_classes') || '[]');
    const container = document.getElementById('class-list-container');
    
    if(classes.length === 0) {
      container.innerHTML = '<div class="empty-state" style="padding:20px; font-size:12px; color:#94a3b8;">+ ë²„íŠ¼ì„ ëˆŒëŸ¬ í•™ê¸‰ì„ ì¶”ê°€í•˜ì„¸ìš”</div>';
      return;
    }

    // "ì „ì²´" í•™ê¸‰ì„ ë¶„ë¦¬
    const allClass = classes.find(c => c.id === 'class_all');
    const otherClasses = classes.filter(c => c.id !== 'class_all');
    
    // ë‚˜ë¨¸ì§€ í•™ê¸‰ ì •ë ¬: í•™ë…„/ë°˜ë³„ í•™ê¸‰ì„ ë¨¼ì €, ê·¸ ë‹¤ìŒ ì‚¬ìš©ìê°€ ì¶”ê°€í•œ í•™ê¸‰
    otherClasses.sort((a, b) => {
      // í•™ë…„/ë°˜ í˜•ì‹ì¸ í•™ê¸‰ì€ í•™ë…„ìˆœ, ë°˜ìˆœìœ¼ë¡œ ì •ë ¬
      const aMatch = a.name.match(/(\d+)í•™ë…„\s*(\d+)ë°˜/);
      const bMatch = b.name.match(/(\d+)í•™ë…„\s*(\d+)ë°˜/);
      
      if(aMatch && bMatch) {
        const aGrade = parseInt(aMatch[1]);
        const aClass = parseInt(aMatch[2]);
        const bGrade = parseInt(bMatch[1]);
        const bClass = parseInt(bMatch[2]);
        
        if(aGrade !== bGrade) return aGrade - bGrade;
        return aClass - bClass;
      }
      
      if(aMatch) return -1; // í•™ë…„/ë°˜ í˜•ì‹ì´ ìš°ì„ 
      if(bMatch) return 1;
      
      // ë‚˜ë¨¸ì§€ëŠ” ì´ë¦„ìˆœ
      return a.name.localeCompare(b.name);
    });
    
    // "ì „ì²´" í•™ê¸‰ì„ ë§¨ ìœ„ì—, ë‚˜ë¨¸ì§€ëŠ” ê·¸ ì•„ë˜ì— ë°°ì¹˜
    const sortedClasses = allClass ? [allClass, ...otherClasses] : otherClasses;
    
    let html = '';
    sortedClasses.forEach((classItem, index) => {
      const isActive = localStorage.getItem('selected_class') === classItem.id;
      const isAllClass = classItem.id === 'class_all';
      html += `
        <div class="class-item ${isActive ? 'active' : ''}" style="display: flex; justify-content: space-between; align-items: center;">
          <span onclick="selectClass('${classItem.id}')" style="flex: 1; cursor: pointer;">${classItem.name}</span>
          ${!isAllClass ? `<button class="btn-delete-student" onclick="deleteClass('${classItem.id}', '${classItem.name}')" title="í•™ê¸‰ ì‚­ì œ" style="margin-left: 8px;">ğŸ—‘ï¸</button>` : ''}
          </div>
      `;
    });
    container.innerHTML = html;
  }
  
  // í•™ê¸‰ ì„ íƒ
  function selectClass(classId) {
    localStorage.setItem('selected_class', classId);
    renderClassList();
    renderStudentList(classId);
  }
  
  // í•™ìƒ ëª©ë¡ ë Œë”ë§ (í•™ê¸‰ë³„)
  function renderStudentList(classId) {
    const classes = JSON.parse(localStorage.getItem('teacher_classes') || '[]');
    const classItem = classes.find(c => c.id === classId);
    if(!classItem) return;
    
    const allSubmissions = JSON.parse(localStorage.getItem('student_submissions') || '[]');
    const container = document.getElementById('student-list-container');
    
    // "ì „ì²´" í•™ê¸‰ì¸ ê²½ìš° ëª¨ë“  í•™ìƒ í‘œì‹œ
    if(classId === 'class_all') {
      const allStudents = [...new Set(allSubmissions.map(s => `${s.id}|${s.name}`))];
      
      if(allStudents.length === 0) {
        container.innerHTML = '<div class="empty-state" style="padding:20px; font-size:12px; color:#94a3b8;">ì œì¶œëœ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤</div>';
        document.getElementById('student-worksheet-container').innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ‘†</div><div>í•™ìƒì„ ì„ íƒí•˜ì„¸ìš”</div></div>';
        return;
      }
      
      let html = '';
      allStudents.forEach(studentKey => {
        const [id, name] = studentKey.split('|');
        const submission = allSubmissions.find(s => s.id === id && s.name === name);
        const hasSubmission = !!submission;
        const pendingCount = hasSubmission && submission.status === 'pending' ? 1 : 0;
        
        html += `
          <div class="student-item">
            <span onclick="selectStudent('${id}', '${name}')" style="flex: 1; cursor: pointer;">${id} ${name}</span>
            <div class="student-actions" onclick="event.stopPropagation();">
              ${pendingCount > 0 ? `<span class="student-badge">${pendingCount}</span>` : ''}
              <button class="btn-delete-student" onclick="deleteStudent('${id}', '${name}')" title="í•™ìƒ ì‚­ì œ">ğŸ—‘ï¸</button>
          </div>
            </div>
        `;
      });
      container.innerHTML = html;
      return;
    }
    
    // ì¼ë°˜ í•™ê¸‰ì¸ ê²½ìš°: í•™ë²ˆ ê¸°ë°˜ìœ¼ë¡œ ì˜¬ë°”ë¥¸ í•™ìƒë§Œ í‘œì‹œ
    const classStudents = classItem.students || [];
    
    // í•™ë²ˆ ê¸°ë°˜ìœ¼ë¡œ í•„í„°ë§: í˜„ì¬ í•™ê¸‰ ì´ë¦„ê³¼ ì¼ì¹˜í•˜ëŠ” í•™ìƒë§Œ í‘œì‹œ
    const filteredStudents = classStudents.filter(studentKey => {
      const [id, name] = studentKey.split('|');
      const classInfo = extractGradeAndClass(id);
      if(!classInfo) return false; // í•™ë²ˆ í˜•ì‹ì´ ë§ì§€ ì•Šìœ¼ë©´ ì œì™¸
      
      // í•™ë²ˆ ê¸°ë°˜ìœ¼ë¡œ ì¶”ì¶œí•œ í•™ê¸‰ ì´ë¦„ì´ í˜„ì¬ í•™ê¸‰ ì´ë¦„ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
      return classInfo.className === classItem.name;
    });
    
    // í•™ê¸‰ ì •ë³´ ì—…ë°ì´íŠ¸ (ì˜ëª» ë°°ì •ëœ í•™ìƒ ì œê±°)
    if(filteredStudents.length !== classStudents.length) {
      classItem.students = filteredStudents;
      const updatedClasses = classes.map(c => c.id === classId ? classItem : c);
      localStorage.setItem('teacher_classes', JSON.stringify(updatedClasses));
    }
    
    if(filteredStudents.length === 0) {
      container.innerHTML = '<div class="empty-state" style="padding:20px; font-size:12px; color:#94a3b8;">ì´ í•™ê¸‰ì— í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤</div>';
      document.getElementById('student-worksheet-container').innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ‘†</div><div>í•™ìƒì„ ì„ íƒí•˜ì„¸ìš”</div></div>';
      return;
    }
    
    let html = '';
    filteredStudents.forEach(studentKey => {
      const [id, name] = studentKey.split('|');
      const submission = allSubmissions.find(s => s.id === id && s.name === name);
      const hasSubmission = !!submission;
      const pendingCount = hasSubmission && submission.status === 'pending' ? 1 : 0;
      
      html += `
        <div class="student-item">
          <span onclick="selectStudent('${id}', '${name}')" style="flex: 1; cursor: pointer;">${id} ${name}</span>
          <div class="student-actions" onclick="event.stopPropagation();">
            ${pendingCount > 0 ? `<span class="student-badge">${pendingCount}</span>` : ''}
            <button class="btn-delete-student" onclick="deleteStudent('${id}', '${name}')" title="í•™ìƒ ì‚­ì œ">ğŸ—‘ï¸</button>
          </div>
        </div>
      `;
    });
    container.innerHTML = html;
  }

  // í•™ìƒë³„ ê´€ë¦¬ ë Œë”ë§
  function renderStudentManagement() {
    const allSubmissions = JSON.parse(localStorage.getItem('student_submissions') || '[]');
    const container = document.getElementById('all-student-list-container');
    
    // ëª¨ë“  í•™ìƒ ì¶”ì¶œ (ì¤‘ë³µ ì œê±°)
    const studentMap = new Map();
    allSubmissions.forEach(sub => {
      const key = `${sub.id}|${sub.name}`;
      if(!studentMap.has(key)) {
        studentMap.set(key, { id: sub.id, name: sub.name, submission: sub });
      }
    });
    
    if(studentMap.size === 0) {
      container.innerHTML = '<div class="empty-state" style="padding:20px; font-size:12px; color:#94a3b8;">ì œì¶œëœ ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤</div>';
      document.getElementById('all-student-worksheet-container').innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“</div><div>ì œì¶œëœ ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤</div></div>';
      return;
    }
    
    let html = '';
    studentMap.forEach((student, key) => {
      const pendingCount = student.submission.status === 'pending' ? 1 : 0;
      html += `
        <div class="student-item">
          <span onclick="selectStudent('${student.id}', '${student.name}')" style="flex: 1; cursor: pointer;">${student.id} ${student.name}</span>
          <div class="student-actions" onclick="event.stopPropagation();">
            ${pendingCount > 0 ? `<span class="student-badge">${pendingCount}</span>` : ''}
            <button class="btn-delete-student" onclick="deleteStudent('${student.id}', '${student.name}')" title="í•™ìƒ ì‚­ì œ">ğŸ—‘ï¸</button>
          </div>
        </div>
      `;
    });
    container.innerHTML = html;
  }
  
  // í•™ìƒ ì„ íƒ ë° í•™ìŠµì§€ í‘œì‹œ
  function selectStudent(studentId, studentName) {
    // ëª¨ë“  student-itemì—ì„œ active ì œê±°
    document.querySelectorAll('.student-item').forEach(item => item.classList.remove('active'));
    // í´ë¦­ëœ í•­ëª©ì— active ì¶”ê°€
    event.currentTarget.classList.add('active');
    
    const allSubmissions = JSON.parse(localStorage.getItem('student_submissions') || '[]');
    const submission = allSubmissions.find(s => s.id === studentId && s.name === studentName);
    
    // í•™ìƒë³„ ê´€ë¦¬ ë·°ì¸ì§€ í•™ê¸‰ë³„ ê´€ë¦¬ ë·°ì¸ì§€ í™•ì¸
    const isStudentManagement = document.getElementById('student-management-view').style.display !== 'none';
    const container = isStudentManagement 
      ? document.getElementById('all-student-worksheet-container')
      : document.getElementById('student-worksheet-container');
    
    if(!submission) {
      container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“</div><div>ì•„ì§ ì œì¶œëœ ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤</div></div>';
      return;
    }
    
    renderStudentWorksheet(submission, container);
  }
  
  // í•™ìŠµì§€ ë Œë”ë§
  function renderStudentWorksheet(submission, container) {
    const statusText = {
      'pending': 'ëŒ€ê¸°ì¤‘',
      'approved': 'ìŠ¹ì¸ë¨',
      'rejected': 'ë°˜ë ¤ë¨'
    };
    
    const html = `
      <div class="student-worksheet">
        <div class="worksheet-header">
          <div class="worksheet-title">${submission.id} ${submission.name}</div>
          <div class="worksheet-status ${submission.status}">${statusText[submission.status]}</div>
        </div>
        
        <div class="worksheet-section">
          <div class="worksheet-label">ë¬¸ì œ</div>
          <div class="worksheet-value">${submission.problem || '-'}</div>
        </div>
        
        <div class="worksheet-section">
          <div class="worksheet-label">SDG ëª©í‘œ</div>
          <div class="worksheet-value">${submission.sdg || '-'}</div>
        </div>
        
        <div class="worksheet-section">
          <div class="worksheet-label">ì‹œë‚˜ë¦¬ì˜¤</div>
          <div class="worksheet-value">${submission.scenario || '-'}</div>
        </div>
        
        <div class="worksheet-feedback">
          <div class="worksheet-label">í”¼ë“œë°±</div>
          <textarea id="worksheet-feedback-${submission.timestamp}" class="worksheet-feedback-input" placeholder="í”¼ë“œë°±ì„ ì…ë ¥í•˜ì„¸ìš”...">${submission.teacherFeedback || ''}</textarea>
          <div class="worksheet-actions">
            <button class="worksheet-btn approve" onclick="updateStudentStatus('${submission.timestamp}', 'approved')">ìŠ¹ì¸</button>
            <button class="worksheet-btn reject" onclick="updateStudentStatus('${submission.timestamp}', 'rejected')">ë°˜ë ¤</button>
          </div>
          </div>
        </div>
      `;
    
    container.innerHTML = html;
  }

  // í•™ìƒ ìƒíƒœ ì—…ë°ì´íŠ¸
  function updateStudentStatus(timestamp, newStatus) {
    let data = JSON.parse(localStorage.getItem('student_submissions') || '[]');
    const idx = data.findIndex(d => d.timestamp === timestamp);
    
    if(idx === -1) return;

    const feedbackEl = document.getElementById(`worksheet-feedback-${timestamp}`);
    const feedback = feedbackEl ? feedbackEl.value : '';
    
    if(newStatus === 'rejected' && !feedback.trim()) {
      alert("ë°˜ë ¤ ì‹œ í”¼ë“œë°±ì„ ë°˜ë“œì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }

    data[idx].status = newStatus;
    data[idx].teacherFeedback = feedback;
    
    localStorage.setItem('student_submissions', JSON.stringify(data));
    
    // í˜„ì¬ ì„ íƒëœ í•™ìƒ ì •ë³´ë¡œ í•™ìŠµì§€ ë‹¤ì‹œ ë Œë”ë§
    const submission = data[idx];
    const isStudentManagement = document.getElementById('student-management-view').style.display !== 'none';
    const container = isStudentManagement 
      ? document.getElementById('all-student-worksheet-container')
      : document.getElementById('student-worksheet-container');
    
    renderStudentWorksheet(submission, container);
    
    // í•™ìƒ ëª©ë¡ë„ ì—…ë°ì´íŠ¸ (ë°°ì§€ í‘œì‹œë¥¼ ìœ„í•´)
    const tabType = isStudentManagement ? 'student' : 'class';
    switchTeacherTab(tabType);
    if(!isStudentManagement) {
      const selectedClass = localStorage.getItem('selected_class');
      if(selectedClass) {
        selectClass(selectedClass);
      }
    }
    
    alert("ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤. í•™ìƒì´ ë‹¤ìŒ ë¡œê·¸ì¸ ì‹œ í”¼ë“œë°± ì•Œë¦¼ì„ ë°›ê²Œ ë©ë‹ˆë‹¤.");
  }
  
  // í•™ìƒ ì‚­ì œ í•¨ìˆ˜
  function deleteStudent(studentId, studentName) {
    if(!confirm(`"${studentId} ${studentName}" í•™ìƒì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì‚­ì œë  ë‚´ìš©:\n- ì œì¶œí•œ ê³¼ì œ\n- í•™ê¸‰ ì •ë³´\n- í•™ìŠµ ì™„ë£Œ ìƒíƒœ`)) {
      return;
    }
    
    const studentKey = `${studentId}|${studentName}`;
    
    // 1. ì œì¶œ ë°ì´í„°ì—ì„œ ì‚­ì œ
    let submissions = JSON.parse(localStorage.getItem('student_submissions') || '[]');
    submissions = submissions.filter(s => !(s.id === studentId && s.name === studentName));
    localStorage.setItem('student_submissions', JSON.stringify(submissions));
    
    // 2. ëª¨ë“  í•™ê¸‰ì—ì„œ í•™ìƒ ì œê±°
    let classes = JSON.parse(localStorage.getItem('teacher_classes') || '[]');
    classes = classes.map(classItem => {
      if(classItem.students && classItem.students.includes(studentKey)) {
        classItem.students = classItem.students.filter(s => s !== studentKey);
      }
      return classItem;
    });
    localStorage.setItem('teacher_classes', JSON.stringify(classes));
    
    // 3. í•™ìŠµ ì™„ë£Œ ìƒíƒœ ì‚­ì œ
    const completedKey = `learning_completed_${studentId}_${studentName}`;
    localStorage.removeItem(completedKey);
    
    // 4. UI ìƒˆë¡œê³ ì¹¨
    const isStudentManagement = document.getElementById('student-management-view').style.display !== 'none';
    if(isStudentManagement) {
      renderStudentManagement();
      document.getElementById('all-student-worksheet-container').innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ‘†</div><div>í•™ìƒì„ ì„ íƒí•˜ì„¸ìš”</div></div>';
    } else {
      const selectedClass = localStorage.getItem('selected_class');
      if(selectedClass) {
        selectClass(selectedClass);
      }
      document.getElementById('student-worksheet-container').innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ‘†</div><div>í•™ìƒì„ ì„ íƒí•˜ì„¸ìš”</div></div>';
    }
    
    alert(`"${studentId} ${studentName}" í•™ìƒì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
  }
  
  // í•™ê¸‰ ì‚­ì œ í•¨ìˆ˜
  function deleteClass(classId, className) {
    if(!confirm(`"${className}" í•™ê¸‰ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\ní•™ê¸‰ì´ ì‚­ì œë˜ì–´ë„ í•™ìƒ ë°ì´í„°ëŠ” ìœ ì§€ë©ë‹ˆë‹¤.`)) {
      return;
    }
    
    let classes = JSON.parse(localStorage.getItem('teacher_classes') || '[]');
    classes = classes.filter(c => c.id !== classId);
    localStorage.setItem('teacher_classes', JSON.stringify(classes));
    
    // ì„ íƒëœ í•™ê¸‰ì´ ì‚­ì œëœ í•™ê¸‰ì´ë©´ ì„ íƒ í•´ì œ
    if(localStorage.getItem('selected_class') === classId) {
      localStorage.removeItem('selected_class');
    }
    
    // UI ìƒˆë¡œê³ ì¹¨
    renderClassList();
    document.getElementById('student-list-container').innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“š</div><div>í•™ê¸‰ì„ ì„ íƒí•˜ì„¸ìš”</div></div>';
    document.getElementById('student-worksheet-container').innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ‘†</div><div>í•™ìƒì„ ì„ íƒí•˜ì„¸ìš”</div></div>';
    
    alert(`"${className}" í•™ê¸‰ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
  }
  
  // í•™ë²ˆì—ì„œ í•™ë…„ê³¼ ë°˜ ì¶”ì¶œ
  function extractGradeAndClass(studentId) {
    if(!studentId || studentId.length !== 5) return null;
    
    // í•™ë²ˆ í˜•ì‹: ì´ 5ìë¦¬
    // ì²« ë²ˆì§¸ ìë¦¬: í•™ë…„
    // ë‘ ë²ˆì§¸ + ì„¸ ë²ˆì§¸ ìë¦¬: ë°˜ (2ìë¦¬)
    // ë„¤ ë²ˆì§¸ + ë‹¤ì„¯ ë²ˆì§¸ ìë¦¬: ë²ˆí˜¸ (2ìë¦¬)
    // ì˜ˆ: 20325 -> 2í•™ë…„ 03ë°˜ 25ë²ˆ -> 2í•™ë…„ 3ë°˜
    // ì˜ˆ: 11111 -> 1í•™ë…„ 11ë°˜ 11ë²ˆ -> 1í•™ë…„ 11ë°˜
    // ì˜ˆ: 20312 -> 2í•™ë…„ 03ë°˜ 12ë²ˆ -> 2í•™ë…„ 3ë°˜
    
    const idStr = studentId.toString();
    
    if(idStr.length === 5) {
      const grade = parseInt(idStr[0]);              // ì²« ë²ˆì§¸ ìë¦¬: í•™ë…„
      const classNum = parseInt(idStr.substring(1, 3)); // ë‘ ë²ˆì§¸+ì„¸ ë²ˆì§¸ ìë¦¬: ë°˜
      
      // í•™ë…„ì´ 1-6 ì‚¬ì´ì´ê³ , ë°˜ì´ 1-99 ì‚¬ì´ì¸ ê²½ìš°ë§Œ ìœ íš¨
      if(grade >= 1 && grade <= 6 && classNum >= 1 && classNum <= 99) {
        return {
          grade: grade,
          classNum: classNum,
          className: `${grade}í•™ë…„ ${classNum}ë°˜`
        };
      }
    }
    
    return null;
  }
  
  // í•™ë²ˆ ê¸°ë°˜ìœ¼ë¡œ í•™ìƒì„ í•™ê¸‰ì— ìë™ ë°°ì •
  function assignStudentToClassById(studentId, studentName) {
    const classInfo = extractGradeAndClass(studentId);
    if(!classInfo) return; // í•™ë²ˆ í˜•ì‹ì´ ë§ì§€ ì•Šìœ¼ë©´ ë°°ì •í•˜ì§€ ì•ŠìŒ
    
    const studentKey = `${studentId}|${studentName}`;
    let classes = JSON.parse(localStorage.getItem('teacher_classes') || '[]');
    const correctClassName = classInfo.className;
    
    // í•´ë‹¹ í•™ìƒì„ ì˜ëª» ë°°ì •ëœ í•™ê¸‰ì—ì„œ ì œê±° (ì˜¬ë°”ë¥¸ í•™ê¸‰ê³¼ "ì „ì²´" ì œì™¸)
    classes = classes.map(classItem => {
      if(classItem.students && classItem.students.includes(studentKey)) {
        // ì˜¬ë°”ë¥¸ í•™ê¸‰ì´ ì•„ë‹ˆê³  "ì „ì²´"ë„ ì•„ë‹ˆë©´ ì œê±°
        if(classItem.name !== correctClassName && classItem.id !== 'class_all') {
          classItem.students = classItem.students.filter(s => s !== studentKey);
        }
      }
      return classItem;
    });
    
    // í•´ë‹¹ í•™ê¸‰ ì°¾ê¸° ë˜ëŠ” ìƒì„±
    let targetClass = classes.find(c => c.name === correctClassName);
    
    if(!targetClass) {
      // í•™ê¸‰ì´ ì—†ìœ¼ë©´ ìƒì„±
      targetClass = {
        id: 'class_' + classInfo.grade + '_' + classInfo.classNum,
        name: correctClassName,
        students: []
      };
      classes.push(targetClass);
    }
    
    // í•™ìƒì´ í•´ë‹¹ í•™ê¸‰ì— ì—†ìœ¼ë©´ ì¶”ê°€
    if(!targetClass.students.includes(studentKey)) {
      targetClass.students.push(studentKey);
    }
    
    // classes ë°°ì—´ ì—…ë°ì´íŠ¸
    classes = classes.map(c => c.id === targetClass.id ? targetClass : c);
    localStorage.setItem('teacher_classes', JSON.stringify(classes));
  }
  
  // í•™ê¸‰ ì¶”ê°€ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
  function showAddClassDialog() {
    const className = prompt('í•™ê¸‰ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:');
    if(!className || !className.trim()) return;
    
    const classes = JSON.parse(localStorage.getItem('teacher_classes') || '[]');
    const newClass = {
      id: 'class_' + Date.now(),
      name: className.trim(),
      students: []
    };
    
    classes.push(newClass);
    localStorage.setItem('teacher_classes', JSON.stringify(classes));
    
    renderClassList();
    selectClass(newClass.id);
    
    // í•™ìƒ ì¶”ê°€ ì•ˆë‚´
    alert(`"${className}" í•™ê¸‰ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.\ní•™ìƒì€ í•™ë²ˆ|ì´ë¦„ í˜•ì‹ìœ¼ë¡œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
  }

  function goToTeacherConfig() {
    const savedPrompt = localStorage.getItem('teacher_prompt_v1');
    const savedApiKey = localStorage.getItem('openai_api_key');
    if(savedPrompt) document.getElementById('teacher-prompt').value = savedPrompt;
    if(savedApiKey) document.getElementById('api-key').value = savedApiKey;
    showView('view-teacher-config');
  }

  function saveTeacherConfig() {
    const prompt = document.getElementById('teacher-prompt').value;
    const apiKey = document.getElementById('api-key').value.trim();
    
    localStorage.setItem('teacher_prompt_v1', prompt);
    
    if(apiKey) {
      localStorage.setItem('openai_api_key', apiKey);
      alert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (API í‚¤ëŠ” ì•ˆì „í•œ ë°±ì—”ë“œ ì„œë²„ë¥¼ í†µí•´ ê´€ë¦¬í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.)');
    } else {
      localStorage.removeItem('openai_api_key');
      alert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (ê¸°ë³¸ ê²€ì¦ë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.)');
    }
    
    showDashboard();
  }

  function clearData() {
    if(confirm("ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì œì¶œ ë°ì´í„°ì™€ í•™ê¸‰ ì •ë³´ê°€ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤)")) {
      localStorage.removeItem('student_submissions');
      localStorage.removeItem('teacher_classes');
      localStorage.removeItem('selected_class');
      renderTeacherDashboard();
    }
  }

  /* =========================================
     ì´ˆìŒíŒŒ ì„¼ì„œ í•™ìŠµ í˜ì´ì§€ ë¡œì§
     ========================================= */
  let simDistance = 400;
  const soundSpeed = 0.034; // cm/Î¼s

  function initSimulation() {
    updateSimDistance(400);
  }

  function updateSimDistance(val) {
    simDistance = parseInt(val);
    
    // ë‚˜ë°© ìœ„ì¹˜ ê³„ì‚° (400cm = 10%, 2cm = 85%)
    const rightPercent = 85 - ((simDistance - 2) * (75 / 398));
    document.getElementById('sim-moth').style.right = rightPercent + '%';
    
    // ê±°ë¦¬ ë° ì‹œê°„ í‘œì‹œ
    document.getElementById('disp-distance').textContent = `${simDistance}cm`;
    const timeUs = Math.round((simDistance * 2) / soundSpeed);
    document.getElementById('disp-time').textContent = `${timeUs.toLocaleString()}Î¼s`;
    
    // ë°•ì¥ ë§í’ì„  ì—…ë°ì´íŠ¸
    updateBatSpeech(simDistance);
  }
  
  function updateBatSpeech(distance) {
    const speechBubble = document.getElementById('bat-speech-bubble');
    const speechText = document.getElementById('bat-speech-text');
    if(!speechBubble || !speechText) return;
    
    let message = '';
    let bgGradient = '';
    let borderColor = '';
    let textColor = '';
    let tailBorderColor = '';
    
    if (distance >= 300) {
      // ë¨¼ ê²½ìš°: "ìŒ... ì•„ì§ì€ ì¢€ ë¨¼ë°? (íƒìƒ‰ ì¤‘)"
      message = 'ìŒ... ì•„ì§ì€ ì¢€ ë¨¼ë°? (íƒìƒ‰ ì¤‘)';
      bgGradient = 'linear-gradient(135deg, #fef3c7, #fde68a)';
      borderColor = '#f59e0b';
      textColor = '#92400e';
      tailBorderColor = '#f59e0b';
    } else if (distance >= 100) {
      // ì ë‹¹í•œ ê±°ë¦¬: "ì˜¤í˜¸! ë”± ì¢‹ì€ ê±°ë¦¬ë‹¤! (ì¶”ì  ì¤‘)"
      message = 'ì˜¤í˜¸! ë”± ì¢‹ì€ ê±°ë¦¬ë‹¤! (ì¶”ì  ì¤‘)';
      bgGradient = 'linear-gradient(135deg, #dbeafe, #bfdbfe)';
      borderColor = '#3b82f6';
      textColor = '#1e40af';
      tailBorderColor = '#3b82f6';
    } else {
      // ê°€ê¹Œìš´ ê±°ë¦¬: "ì¡ì•˜ë‹¤ ìš”ë†ˆ! (ì‚¬ì •ê¶Œ ì§„ì…)"
      message = 'ì¡ì•˜ë‹¤ ìš”ë†ˆ! (ì‚¬ì •ê¶Œ ì§„ì…)';
      bgGradient = 'linear-gradient(135deg, #dcfce7, #bbf7d0)';
      borderColor = '#22c55e';
      textColor = '#166534';
      tailBorderColor = '#22c55e';
    }
    
    speechText.textContent = message;
    speechText.style.color = textColor;
    
    const bubbleContainer = document.getElementById('bat-bubble-container');
    if(bubbleContainer) {
      bubbleContainer.style.background = bgGradient;
      bubbleContainer.style.borderColor = borderColor;
    }
    
    // ë§í’ì„  ê¼¬ë¦¬ ìƒ‰ìƒ ë³€ê²½
    const tailOuter = document.getElementById('bat-tail-outer');
    const tailInner = document.getElementById('bat-tail-inner');
    if(tailOuter) tailOuter.style.borderRightColor = tailBorderColor;
    
    if(tailInner) {
      // ë‘ ë²ˆì§¸ ê¼¬ë¦¬ëŠ” ë°°ê²½ ê·¸ë¼ë°ì´ì…˜ì— ë§ì¶° ì¡°ì •
      if(distance >= 300) {
        tailInner.style.borderRightColor = '#fde68a';
      } else if(distance >= 100) {
        tailInner.style.borderRightColor = '#bfdbfe';
      } else {
        tailInner.style.borderRightColor = '#bbf7d0';
      }
    }
    
    // ë§í’ì„  í‘œì‹œ
    speechBubble.style.opacity = '1';
  }

  function fireWave() {
    const ping = document.getElementById('wave-ping');
    const pong = document.getElementById('wave-pong');
    const moth = document.getElementById('sim-moth');
    const visual = document.getElementById('sim-visual');
    
    // ì´ˆê¸°í™”
    ping.style.transition = 'none';
    pong.style.transition = 'none';
    ping.style.opacity = '1';
    pong.style.opacity = '0';
    ping.style.left = '90px';
    
    // ë‚˜ë°© ìœ„ì¹˜ ê³„ì‚° (í¼ì„¼íŠ¸ ê¸°ë°˜ìœ¼ë¡œ ê³„ì‚°)
    const visualRect = visual.getBoundingClientRect();
    const visualWidth = visualRect.width;
    const mothRect = moth.getBoundingClientRect();
    const mothLeft = mothRect.left - visualRect.left;
    const targetX = mothLeft + 20; // ë‚˜ë°© ì¤‘ì‹¬ ê¸°ì¤€
    
    // ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ ê³„ì‚° (ê±°ë¦¬ì— ë¹„ë¡€)
    const animTime = 0.3 + (simDistance / 400) * 1.0;
    
    // Ping ì• ë‹ˆë©”ì´ì…˜ (ë°•ì¥ -> ë‚˜ë°©)
    setTimeout(() => {
      ping.style.transition = `left ${animTime}s linear`;
      ping.style.left = `${targetX}px`;
    }, 50);
    
    // Pong ì• ë‹ˆë©”ì´ì…˜ (ë‚˜ë°© -> ë°•ì¥)
    setTimeout(() => {
      ping.style.opacity = '0';
      pong.style.left = `${targetX}px`;
      pong.style.opacity = '1';
      setTimeout(() => {
        pong.style.transition = `left ${animTime}s linear`;
        pong.style.left = '90px';
      }, 50);
    }, animTime * 1000 + 50);
    
    // Pong ì‚¬ë¼ì§
    setTimeout(() => {
      pong.style.opacity = '0';
    }, animTime * 2000 + 100);
  }

  let quizAnswered = false; // í€´ì¦ˆ ì •ë‹µ ì—¬ë¶€
  
  function checkQuizAnswer(btn, isCorrect, answerType) {
    const buttons = document.querySelectorAll('.quiz-option-btn');
    // ì´ì „ ì„ íƒ í•´ì œ (ë‹¤ì‹œ ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡)
    buttons.forEach(b => {
      b.classList.remove('correct', 'wrong');
    });
    
    const feedback = document.getElementById('quiz-feedback');
    feedback.style.display = 'block';
    
    if(isCorrect) {
      btn.classList.add('correct');
      feedback.style.background = 'rgba(236, 253, 245, 0.8)';
      feedback.style.border = '2px solid #10b981';
      feedback.style.color = '#047857';
      feedback.innerHTML = "âœ… ì •ë‹µ! ì´ˆìŒíŒŒ ì„¼ì„œëŠ” ì†Œë¦¬ê°€ ê°”ë‹¤ ì˜¤ëŠ” ì‹œê°„ìœ¼ë¡œ 'ê±°ë¦¬'ë¥¼ ê³„ì‚°í•´ìš”.";
      quizAnswered = true;
    } else {
      btn.classList.add('wrong');
      feedback.style.background = 'rgba(254, 242, 242, 0.8)';
      feedback.style.border = '2px solid #ef4444';
      feedback.style.color = '#991b1b';
      
      // ëª¨ë“  ì˜¤ë‹µì— ë™ì¼í•œ í”¼ë“œë°± í˜•ì‹ ì‚¬ìš©
      feedback.innerHTML = "âŒ ë•¡! ì´ˆìŒíŒŒ ì„¼ì„œëŠ” ë¬¼ì²´ì— ë°˜ì‚¬ë˜ì–´ ëŒì•„ì˜¤ëŠ” 'ì‹œê°„'ì„ ì¸¡ì •í•©ë‹ˆë‹¤. ë‹¤ì‹œ ìƒê°í•´ë³´ê³  ì •ë‹µì„ ì°¾ì•„ë³´ì„¸ìš”! ğŸ’­";
      quizAnswered = false;
    }
  }

  /* =========================================
     ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê¸°ëŠ¥
     ========================================= */
  let draggedElement = null;
  let draggedWord = null;
  
  // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
  function initDragDrop() {
    // ë“œë˜ê·¸ ê°€ëŠ¥í•œ ë‹¨ì–´ë“¤ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    document.querySelectorAll('.drag-word').forEach(word => {
      word.removeEventListener('dragstart', handleDragStart);
      word.removeEventListener('dragend', handleDragEnd);
      word.addEventListener('dragstart', handleDragStart);
      word.addEventListener('dragend', handleDragEnd);
    });
    
    // ë“œë¡­ ì¡´ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    document.querySelectorAll('.drop-zone').forEach(zone => {
      zone.removeEventListener('dragover', handleDragOver);
      zone.removeEventListener('drop', handleDrop);
      zone.removeEventListener('dragenter', handleDragEnter);
      zone.removeEventListener('dragleave', handleDragLeave);
      zone.addEventListener('dragover', handleDragOver);
      zone.addEventListener('drop', handleDrop);
      zone.addEventListener('dragenter', handleDragEnter);
      zone.addEventListener('dragleave', handleDragLeave);
    });
  }
  
  // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
  document.addEventListener('DOMContentLoaded', function() {
    setTimeout(initDragDrop, 100);
  });
  
  function handleDragStart(e) {
    draggedElement = this;
    draggedWord = this.getAttribute('data-word');
    this.style.opacity = '0.5';
    e.dataTransfer.effectAllowed = 'move';
    e.dataTransfer.setData('text/html', this.innerHTML);
  }
  
  function handleDragEnd(e) {
    this.style.opacity = '1';
    document.querySelectorAll('.drop-zone').forEach(zone => {
      const droppedWord = zone.querySelector('.dropped-word');
      if(!droppedWord) {
        zone.style.background = 'white';
        zone.style.border = '2px dashed #c4b5fd';
      }
    });
  }
  
  function handleDragOver(e) {
    if(e.preventDefault) {
      e.preventDefault();
    }
    e.dataTransfer.dropEffect = 'move';
    return false;
  }
  
  function handleDragEnter(e) {
    const droppedWord = this.querySelector('.dropped-word');
    if(!droppedWord) {
      this.style.background = '#ede9fe';
      this.style.border = '2px dashed #8b5cf6';
    }
  }
  
  function handleDragLeave(e) {
    const droppedWord = this.querySelector('.dropped-word');
    if(!droppedWord) {
      this.style.background = 'white';
      this.style.border = '2px dashed #c4b5fd';
    }
  }
  
  function handleDrop(e) {
    if(e.stopPropagation) {
      e.stopPropagation();
    }
    
    if(draggedElement) {
      const word = draggedWord;
      const dropZone = this;
      
      // ì´ë¯¸ ë‹¨ì–´ê°€ ìˆìœ¼ë©´ ì œê±°
      const existingWord = dropZone.querySelector('.dropped-word');
      if(existingWord) {
        // ì›ë˜ ë‹¨ì–´ ë²„íŠ¼ ë³µì›
        const wordText = existingWord.textContent.trim();
        const wordButton = document.createElement('div');
        wordButton.className = 'drag-word';
        wordButton.setAttribute('draggable', 'true');
        wordButton.setAttribute('data-word', wordText);
        wordButton.textContent = wordText;
        wordButton.style.cssText = 'background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; padding: 12px 28px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: grab; user-select: none; box-shadow: 0 4px 8px rgba(139, 92, 246, 0.3); transition: all 0.3s ease;';
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë‹¤ì‹œ ì¶”ê°€
        wordButton.addEventListener('dragstart', handleDragStart);
        wordButton.addEventListener('dragend', handleDragEnd);
        
        draggedElement.parentNode.appendChild(wordButton);
        existingWord.remove();
      }
      
      // ìƒˆ ë‹¨ì–´ ì¶”ê°€ (ê°€ìš´ë° ì •ë ¬)
      dropZone.innerHTML = `<span class="dropped-word" style="color: #1e293b; font-weight: 600; display: block; text-align: center;">${word}</span>`;
      dropZone.style.background = 'white';
      dropZone.style.border = '2px dashed #a78bfa';
      
      // ì›ë˜ ë‹¨ì–´ ë²„íŠ¼ ì œê±°
      draggedElement.remove();
      draggedElement = null;
      draggedWord = null;
    }
    
    return false;
  }
  
  function resetDragDrop() {
    // ëª¨ë“  ë“œë¡­ ì¡´ì—ì„œ ë‹¨ì–´ë¥¼ ë‹¤ì‹œ ë‹¨ì–´ ì»¨í…Œì´ë„ˆë¡œ ì´ë™
    const wordContainer = document.getElementById('word-container');
    if(!wordContainer) return;
    
    // ë“œë¡­ ì¡´ì—ì„œ ë‹¨ì–´ ì¶”ì¶œ
    document.querySelectorAll('.drop-zone').forEach(zone => {
      const droppedWord = zone.querySelector('.dropped-word');
      if(droppedWord) {
        const wordText = droppedWord.textContent.trim();
        
        // ë‹¨ì–´ ë²„íŠ¼ ë‹¤ì‹œ ìƒì„±
        const wordButton = document.createElement('div');
        wordButton.className = 'drag-word';
        wordButton.setAttribute('draggable', 'true');
        wordButton.setAttribute('data-word', wordText);
        wordButton.textContent = wordText;
        wordButton.style.cssText = 'background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; padding: 12px 28px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: grab; user-select: none; box-shadow: 0 4px 8px rgba(139, 92, 246, 0.3); transition: all 0.3s ease;';
        
        wordButton.addEventListener('dragstart', handleDragStart);
        wordButton.addEventListener('dragend', handleDragEnd);
        
        wordContainer.appendChild(wordButton);
      }
      
      // ë“œë¡­ ì¡´ ì´ˆê¸°í™”
      zone.innerHTML = '';
      zone.style.background = 'white';
      zone.style.border = '2px dashed #c4b5fd';
    });
    
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë‹¤ì‹œ ì„¤ì •
    initDragDrop();
    
    // í”¼ë“œë°± ìˆ¨ê¸°ê¸°
    const feedback = document.getElementById('reflection-feedback');
    if(feedback) feedback.style.display = 'none';
  }
  
  function checkDragDropAnswer() {
    const dropZones = [
      { id: 'drop1', correct: 'ì´ˆìŒíŒŒ' },
      { id: 'drop2', correct: 'ë°˜ì‚¬' },
      { id: 'drop3', correct: 'ì‹œê°„' },
      { id: 'drop4', correct: 'ê±°ë¦¬' }
    ];
    
    const reflectionFeedbackDiv = document.getElementById('reflection-feedback');
    reflectionFeedbackDiv.style.display = 'block';
    
    let allFilled = true;
    let allCorrect = true;
    const wrongBlanks = [];
    
    dropZones.forEach((zone, index) => {
      const dropZone = document.getElementById(zone.id);
      const droppedWord = dropZone.querySelector('.dropped-word');
      
      if(!droppedWord) {
        allFilled = false;
        dropZone.style.background = '#fee2e2';
        dropZone.style.border = '2px dashed #ef4444';
      } else {
        const word = droppedWord.textContent.trim();
        if(word === zone.correct) {
          dropZone.style.background = '#ede9fe';
          dropZone.style.border = '2px solid #8b5cf6';
        } else {
          allCorrect = false;
          wrongBlanks.push(`${index + 1}ë²ˆ`);
          dropZone.style.background = '#fee2e2';
          dropZone.style.border = '2px solid #ef4444';
        }
      }
    });
    
    if(!allFilled) {
      reflectionFeedbackDiv.style.background = 'rgba(254, 242, 242, 0.8)';
      reflectionFeedbackDiv.style.border = '2px solid #ef4444';
      reflectionFeedbackDiv.style.color = '#991b1b';
      reflectionFeedbackDiv.innerHTML = "âŒ ëª¨ë“  ë¹ˆì¹¸ì„ ì±„ì›Œì£¼ì„¸ìš”!";
      return;
    }
    
    if(!allCorrect) {
      reflectionFeedbackDiv.style.background = 'rgba(254, 242, 242, 0.8)';
      reflectionFeedbackDiv.style.border = '2px solid #ef4444';
      reflectionFeedbackDiv.style.color = '#991b1b';
      reflectionFeedbackDiv.innerHTML = `âŒ <strong>í‹€ë ¸ìŠµë‹ˆë‹¤!</strong><br>${wrongBlanks.join(', ')} ë¹ˆì¹¸ì„ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.<br><br>ğŸ’¡ <strong>íŒíŠ¸:</strong> ì´ˆìŒíŒŒ ì„¼ì„œëŠ” ì´ˆìŒíŒŒë¥¼ ì˜ê³ , ë¬¼ì²´ì— ë°˜ì‚¬ë˜ì–´ ëŒì•„ì˜¤ëŠ” ì‹œê°„ìœ¼ë¡œ ê±°ë¦¬ë¥¼ ì¸¡ì •í•©ë‹ˆë‹¤.`;
      return;
    }
    
    // ëª¨ë‘ ì •ë‹µì¼ ë•Œ
    reflectionFeedbackDiv.style.background = 'rgba(237, 233, 254, 0.9)';
    reflectionFeedbackDiv.style.border = '2px solid #8b5cf6';
    reflectionFeedbackDiv.style.color = '#6d28d9';
    reflectionFeedbackDiv.innerHTML = "âœ… <strong>ëª¨ë‘ ë§ìŠµë‹ˆë‹¤!</strong> ì´ˆìŒíŒŒ ì„¼ì„œì˜ ì›ë¦¬ë¥¼ ì˜ ì´í•´í•˜ì…¨ë„¤ìš”!";
  }
  
  function completeLearning() {
    // 1. í€´ì¦ˆ ì •ë‹µ í™•ì¸
    if(!quizAnswered) {
      alert("âš ï¸ ê°œë… ì²´í¬ ë¬¸ì œì˜ ì •ë‹µì„ ë¨¼ì € ë§ì¶°ì£¼ì„¸ìš”! ì •ë‹µì„ ì„ íƒí•˜ë©´ ì´ˆë¡ìƒ‰ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.");
      return;
    }
    
    // 2. ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì •ë‹µ í™•ì¸
    const dropZones = [
      { id: 'drop1', correct: 'ì´ˆìŒíŒŒ' },
      { id: 'drop2', correct: 'ë°˜ì‚¬' },
      { id: 'drop3', correct: 'ì‹œê°„' },
      { id: 'drop4', correct: 'ê±°ë¦¬' }
    ];
    
    const reflectionFeedbackDiv = document.getElementById('reflection-feedback');
    reflectionFeedbackDiv.style.display = 'block';
    
    let allFilled = true;
    let allCorrect = true;
    
    dropZones.forEach((zone) => {
      const dropZone = document.getElementById(zone.id);
      const droppedWord = dropZone.querySelector('.dropped-word');
      
      if(!droppedWord) {
        allFilled = false;
      } else {
        const word = droppedWord.textContent.trim();
        if(word !== zone.correct) {
          allCorrect = false;
        }
      }
    });
    
    if(!allFilled) {
      reflectionFeedbackDiv.style.background = 'rgba(254, 242, 242, 0.8)';
      reflectionFeedbackDiv.style.border = '2px solid #ef4444';
      reflectionFeedbackDiv.style.color = '#991b1b';
      reflectionFeedbackDiv.innerHTML = "âŒ ëª¨ë“  ë¹ˆì¹¸ì„ ì±„ì›Œì£¼ì„¸ìš”!";
      return;
    }
    
    if(!allCorrect) {
      reflectionFeedbackDiv.style.background = 'rgba(254, 242, 242, 0.8)';
      reflectionFeedbackDiv.style.border = '2px solid #ef4444';
      reflectionFeedbackDiv.style.color = '#991b1b';
      reflectionFeedbackDiv.innerHTML = "âŒ <strong>í‹€ë ¸ìŠµë‹ˆë‹¤!</strong> ì •ë‹µ í™•ì¸ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì˜¬ë°”ë¥¸ ë‹µì„ í™•ì¸í•´ì£¼ì„¸ìš”.";
      return;
    }
    
    // ëª¨ë‘ ì •ë‹µì¼ ë•Œ
    reflectionFeedbackDiv.style.background = 'rgba(237, 233, 254, 0.9)';
    reflectionFeedbackDiv.style.border = '2px solid #8b5cf6';
    reflectionFeedbackDiv.style.color = '#6d28d9';
    reflectionFeedbackDiv.innerHTML = "âœ… <strong>ëª¨ë‘ ë§ìŠµë‹ˆë‹¤!</strong> ì´ˆìŒíŒŒ ì„¼ì„œì˜ ì›ë¦¬ë¥¼ ì˜ ì´í•´í•˜ì…¨ë„¤ìš”! ì´ì œ ì„¤ê³„í•˜ëŸ¬ ê°€ë³¼ê¹Œìš”? ğŸ‘‰";
    
    setTimeout(() => {
      // í•™ìŠµ ì™„ë£Œ ìƒíƒœ ì €ì¥
      if(currentUser && currentUser.id && currentUser.name) {
        setLearningCompleted(currentUser.id, currentUser.name);
      }
      
      // í•™ìŠµ ì™„ë£Œ í›„ í•™ìƒ ë©”ì¸ìœ¼ë¡œ ì´ë™
      loadMySubmission();
      showView('view-student-main');
    }, 1500);
  }

  /* === ë°•ì¥ ìƒì„± ìŠ¤í¬ë¦½íŠ¸ === */
  function createBats() {
    const container = document.getElementById('bat-container');
    if(!container) return; // ì»¨í…Œì´ë„ˆê°€ ì—†ìœ¼ë©´ ë¦¬í„´
    
    // ê¸°ì¡´ ë°•ì¥ ì œê±°
    container.innerHTML = '';
    
    const batCount = 20; // ë°•ì¥ ë§ˆë¦¬ ìˆ˜
    
    for(let i=0; i<batCount; i++) {
      const bat = document.createElement('div');
      bat.innerText = 'ğŸ¦‡';
      bat.classList.add('flying-bat');
      
      // 1. ëœë¤ ì‹œì‘ ìœ„ì¹˜ (Yì¶• 0~100%)
      const startY = Math.random() * 100;
      
      // 2. ëœë¤ ì†ë„ (5ì´ˆ ~ 15ì´ˆ ì‚¬ì´)
      const duration = 8 + Math.random() * 12; 
      
      // 3. ëœë¤ ë”œë ˆì´ (0ì´ˆ ~ 5ì´ˆ ì‚¬ì´ - ìì—°ìŠ¤ëŸ½ê²Œ ìˆœì°¨ ë“±ì¥)
      const delay = Math.random() * 5;
      
      // 4. ëœë¤ í¬ê¸° (0.5ë°° ~ 1.5ë°° - ì›ê·¼ê° íš¨ê³¼)
      const scale = 0.5 + Math.random() * 1; 
      
      // ìŠ¤íƒ€ì¼ ì ìš©
      bat.style.top = startY + 'vh';
      bat.style.left = '-10vw'; // í™”ë©´ ì™¼ìª½ ë°–ì—ì„œ ì‹œì‘
      bat.style.animationDuration = duration + 's';
      bat.style.animationDelay = delay + 's';
      bat.style.fontSize = (2 * scale) + 'rem';
      bat.style.opacity = 0.3 + Math.random() * 0.5; // íˆ¬ëª…ë„ë„ ëœë¤
      
      container.appendChild(bat);
    }
  }
  
  // showIntro í•¨ìˆ˜ ìˆ˜ì •
  const originalShowIntro = showIntro;
  showIntro = function() {
    originalShowIntro();
    // ì¸íŠ¸ë¡œ í™”ë©´ì´ í‘œì‹œë  ë•Œ ë°•ì¥ ìƒì„±
    setTimeout(createBats, 100);
  };

  // ì´ˆê¸° ì‹¤í–‰
  // í™˜ê²½ ë³€ìˆ˜ì—ì„œ API í‚¤ê°€ ìˆìœ¼ë©´ localStorageì— ìë™ ì €ì¥
  if(typeof window !== 'undefined' && window.VITE_OPENAI_API_KEY) {
    if(!localStorage.getItem('openai_api_key')) {
      localStorage.setItem('openai_api_key', window.VITE_OPENAI_API_KEY);
    }
  }
  
  // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°•ì¥ ìƒì„±
  window.addEventListener('load', function() {
    if(document.getElementById('view-intro').classList.contains('active')) {
      createBats();
    }
  });
  
  showIntro();
</script>
</body>
</html>